{"cells":[{"metadata":{"_uuid":"d02509bcd9db560fbf95abe651ec2e09468a08be"},"cell_type":"markdown","source":"## Load libraries"},{"metadata":{"_uuid":"c8892f9eeffed15bdbbdf8d4e2a84eaf98b6c87a","_execution_state":"idle","_kg_hide-input":true,"_kg_hide-output":true,"trusted":true},"cell_type":"code","source":"library(tidyverse) # metapackage with lots of helpful functions\nlibrary(randomForest)\nlist.files(path = \"../input\")","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"b5fcaad9406d7814dc8876785071c22354bc0c28"},"cell_type":"markdown","source":"## Read in data."},{"metadata":{"_kg_hide-input":true,"trusted":true,"_uuid":"fe0b1b3afacb3cc4bb0f4d381675e7b7145f2635"},"cell_type":"code","source":"t1 <- read.csv(\"../input/train.csv\",stringsAsFactors = F)\nt2 <- read.csv(\"../input/test.csv\",stringsAsFactors = F)\nall <- bind_rows(t1,t2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e8d4894b9fb9c603e8dd867c9dd614dfb19d5130"},"cell_type":"markdown","source":"## Change to numeric."},{"metadata":{"_kg_hide-input":true,"trusted":true,"_uuid":"5ed2a5ed0cdecc792216e23db648be25e69aa0c1"},"cell_type":"code","source":"colSums(is.na(all))\nall$Fare[all$Fare==0] <- NA\nall$Fare <- as.numeric(all$Fare)\nall$Embarked[all$Embarked==''] <- 'S'\n# Change Embarked.\nall$Embarked[all$Embarked=='C'] <- 0\nall$Embarked[all$Embarked=='Q'] <- 1\nall$Embarked[all$Embarked=='S'] <- 2\nall$Embarked <- as.numeric(all$Embarked)\n# Make sex numeric\nall$Sex[all$Sex=='female'] <- 1\nall$Sex[all$Sex=='male'] <- 0\nall$Sex <- as.numeric(all$Sex)\nstr(all)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"60d561cdc2192591b195b66d3d5f64179a540304"},"cell_type":"markdown","source":"## Find titles."},{"metadata":{"trusted":true,"_uuid":"de26730db7310e8b2c0f39c9f31506cfd8fd0894"},"cell_type":"code","source":"pat <- '\\\\,*+\\\\w+\\\\.'\ntitles <- str_extract(all$Name, pattern = pat)\ntable(titles)\nall$titles <- titles\nti <- data.frame(num=1:length(unique(all$titles)), titel=unique(all$titles))\n# Convert title to a number.\nfor(i in 1:nrow(ti)){\nall$titles[all$titles==ti$titel[i]] <- ti$num[i]\n}\nall$titles <- as.numeric(all$titles)","execution_count":null,"outputs":[]},{"metadata":{"_kg_hide-input":true,"trusted":true,"_uuid":"fa152dde07031e3c6acea27e1938e7e12499f19c"},"cell_type":"code","source":"cor(all[c('Fare','Age','SibSp','Parch','Pclass','Sex','Embarked','Survived','titles')],use = 'c')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7b4bb9cb652f558a84962a10991e526c74e2884e"},"cell_type":"markdown","source":"## Obtain the rows of data."},{"metadata":{"_kg_hide-input":true,"trusted":true,"_uuid":"cf2e153655985f93f7e68825f7e970d6aa06d25b"},"cell_type":"code","source":"not.missing <- which(!is.na(all[,c('Fare','Age')]))\nmissing.fare <- which(is.na(all[,c('Fare')]))\nmissing.fare","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1ca150aa10938f4029044376f93f36d17f800c04"},"cell_type":"markdown","source":"## Impute Fare"},{"metadata":{"_kg_hide-input":true,"trusted":true,"_uuid":"f52acdccd24ed4bb97a3cc4e87da7dd7598cba97"},"cell_type":"code","source":"model <- glm(Fare ~ Pclass+ Embarked, data = all[not.missing,])\npred <- predict(model, all[missing.fare,])\ndata.frame(pred)\nall$Fare[missing.fare] <- pred","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"461b3b6283624dc127762bb28a0783abfd48a8b8"},"cell_type":"markdown","source":"## Impute Age"},{"metadata":{"trusted":true,"_uuid":"1da8e6110e641023d84d146a21b06ec6a9ccdd1f"},"cell_type":"code","source":"not.missing <- which(!is.na(all$Age))\nmissing <- which(is.na(all$Age))\nmodel <- glm(Age ~  Pclass+ Embarked, data = all[not.missing,])\npred <- predict(model, all[missing,])\ndata.frame(pred=head(pred))\nall$Age[missing] <- pred","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"3b0583f2833ebf27e6f7da10c868ae638c9625c8"},"cell_type":"markdown","source":"## Predict survival."},{"metadata":{"_kg_hide-input":true,"trusted":true,"_uuid":"2b60102bf0b5ce432f129c73a6eee0d3b02b22b9"},"cell_type":"code","source":"train.val <-as.integer(891*0.70)\ntest.val <- 891-train.val\n# make all$Survived factor\nall$Survived <- as.factor(all$Survived)\n\ntrain <- all[1:train.val,]\ntest <- all[624:891,]\n\nmodel <- randomForest(Survived ~ Sex+ Pclass+ titles+ Fare, data =train)\npred <- predict(model, test)\n# data.frame(actual=test$Survived[1:100], pred=pred)\ntable(pred=pred,actual=test$Survived)\nmean(pred==test$Survived)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"650778fa500b026c59e92d6275c6cbc46752397e"},"cell_type":"markdown","source":"## Model."},{"metadata":{"_kg_hide-input":true,"trusted":true,"_uuid":"7d493eedb6de624cc74f4820c2b7c06689b5d4b1"},"cell_type":"code","source":"model","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a18a17188d7dd14d60035e168cb011e7000f72b3"},"cell_type":"markdown","source":"## Variable importance."},{"metadata":{"trusted":true,"_uuid":"3153cf3516bdcfb2305044003724def51fe10eec"},"cell_type":"code","source":"options(repr.plot.width=7, repr.plot.height=5)\nvarImpPlot(model, sort = T)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"76275d4e653cfdf2d0f92223df019d5319a8d17f"},"cell_type":"markdown","source":"## Create submission."},{"metadata":{"_kg_hide-input":true,"trusted":true,"_uuid":"5dde31315ba2e49082332e393cab75ac5c05a4d9"},"cell_type":"code","source":"pred <- predict(model,all[892:1309,])\nsubmit <- data.frame(PassengerId=892:1309,Survived=pred)\nwrite.csv(submit, file = 'RF_submission_t.csv', row.names = F)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"2f240502b07877c7fa203aab5622c7e3efe62b05"},"cell_type":"code","source":"","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}