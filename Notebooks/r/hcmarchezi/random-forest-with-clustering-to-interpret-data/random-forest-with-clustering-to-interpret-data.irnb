{"cells":[{"metadata":{"_cell_guid":"c651cc9b-1d56-afc7-b077-6bfe66ff0692","_uuid":"97c1ac2753485c4f56477514056ee65fd657e45a"},"cell_type":"markdown","source":"This experiment shows how a combination of random forest with clustering can help understand what types of passengers would be likely to survive the titanic disaster."},{"metadata":{"_cell_guid":"199e5f00-af2b-6c17-334d-5fba6e9bd117","_uuid":"aff446e152d1d8cee9577994a5118f211797870f","trusted":true},"cell_type":"code","source":"library(ggplot2) # Data visualization\nlibrary(readr) # CSV file I/O, e.g. the read_csv function\nlibrary(dplyr)\nlibrary(psych)\nlibrary(randomForest)\nlibrary(cluster)\nlibrary(clValid)\n\n# Input data files are available in the \"../input/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\nsystem(\"ls ../input\")\n\nset.seed(100)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"6b95d805-3484-a01f-bf67-01935025fa29","_uuid":"ba5907e0b95ab769933b233a0e23890c15e1c39d"},"cell_type":"markdown","source":"## Loading data ##"},{"metadata":{"_cell_guid":"95e4a9c7-e4ab-e877-b079-b6df801f962d","_uuid":"140dbd6dee16fbcaae728d61cbd036d50556683f","trusted":true},"cell_type":"code","source":"data <- read.csv('../input/train.csv', stringsAsFactors = FALSE)\nglimpse(data)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"bcba37c3-bf02-ac3e-5536-918b3d57f90b","_uuid":"853dce279317e35fb6d64613f0b9f43acc01bbc3"},"cell_type":"markdown","source":"## Converting categorical into one-hot-encoding ##"},{"metadata":{"_cell_guid":"8ecdd805-9ac4-a438-3b6b-cef8844bb48a","_uuid":"8aa0535a890205460dbf0062a1c00ace492bcfba","trusted":true},"cell_type":"code","source":"df_class <- dummy.code(data$Pclass) %>%\n                data.frame()\nnames(df_class) <- c(\"class1\", \"class2\", \"class3\")\nglimpse(df_class)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"c87f3aa7-7961-b7be-c6ca-7f8866e27562","_uuid":"6b8e8ed7d4b2bacc84b5e395a311493abb088418","trusted":true},"cell_type":"code","source":"df_sibsp <- dummy.code(data$SibSp) %>%\n                data.frame()\nnames(df_sibsp) <- c(\"S0\", \"S1\", \"S2\", \"S3\", \"S4\", \"S5\", \"S6\")\nglimpse(df_sibsp)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"beaf665e-2cf6-9f84-a76c-64b8d29c95f4","_uuid":"cc0650871b958c98060a47fed635548bbaf786be","trusted":true},"cell_type":"code","source":"df_parch <- dummy.code(data$Parch) %>%\n                data.frame()\nnames(df_parch) <- c(\"P0\", \"P1\", \"P2\", \"P3\", \"P4\", \"P5\", \"P6\")\nglimpse(df_parch)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"8b30075b-ae1c-51bf-cf79-3fb163e2e0bf","_uuid":"75d36e3215e7d4926289420fb479efc8410b7974","trusted":true},"cell_type":"code","source":"df_embarked <- dummy.code(data$Embarked) %>%\n                data.frame()\nnames(df_embarked) <- c(\"E1\", \"EC\", \"EQ\", \"ES\")\nglimpse(df_embarked)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"909a7c3b-a5cb-0bb8-b0a8-23dcb50b4616","_uuid":"d610b1c180a14336755f5edcd276050d98846b4c"},"cell_type":"markdown","source":"## Replacing categorical for one-hot-encoding in a data.frame ##"},{"metadata":{"_cell_guid":"07e96fbe-af96-deac-2d2b-e86ae9b9eb35","_uuid":"6064ce355340d62dbe29e05395c1a3f432ba05d1","trusted":true},"cell_type":"code","source":"df_processed <- data %>%\n    mutate(Sex = ifelse(Sex == 'male', 1, 0)) %>%\n    cbind(df_class) %>%\n    cbind(df_sibsp) %>%\n    cbind(df_parch) %>%\n    cbind(df_embarked) %>%\n    select(-PassengerId, -Pclass, -Name, -SibSp, -Parch, -Ticket, -Fare, -Cabin, -Embarked) %>%\n    na.omit()\ndf_processed <- df_processed[sample(nrow(df_processed)),]\nglimpse(df_processed)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"2d97d6ee-0181-c20b-a47b-ab6fa4d1ddf5","_uuid":"268b94b056501479e3744cdf398f0c6558167103"},"cell_type":"markdown","source":"## Splitting data into training and test ##"},{"metadata":{"_cell_guid":"b30cf072-707b-4fca-1c4d-a7c682bf34d3","_uuid":"b09c6a2abf29db264cec5ccb80ca01cfa744b0da","trusted":true},"cell_type":"code","source":"last  = nrow(df_processed)\npivot = round(last*0.7)\ncat('pivot = ', pivot, '\\n')\n\ndf_train <- df_processed[1:pivot,]\ncat('train size:', nrow(df_train), '\\n')\ndf_test  <- df_processed[(pivot+1):last,]\ncat('test size:', nrow(df_test), '\\n')","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"150a295b-92c1-01de-8b5b-41beb4457155","_uuid":"d6af18baf89371fde5c67d1b6afa81b2292c9627"},"cell_type":"markdown","source":"## Training random forest with training dataframe ##"},{"metadata":{"_cell_guid":"e2905834-3414-a2fc-f4e4-a2b65c6fcc66","_uuid":"38f1d8e38e53e7762faf81220653e81f7f587767","trusted":true},"cell_type":"code","source":"df_train_x = df_train %>% select(-Survived)\ndf_train_y = df_train %>% select(Survived)\nbosh.rf <- randomForest(x = df_train_x, y = df_train_y$Survived)\nprint(bosh.rf)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"cfc69767-8f45-2965-4801-4cf1130697f2","_uuid":"46ec72e7cc7223ef9d9ebab0a883fd3316f38662"},"cell_type":"markdown","source":"## Testing random forest predictions ##"},{"metadata":{"_cell_guid":"f5e23027-e626-1a39-cfb1-22bcff1cfa59","_uuid":"101fcd1e19ffcf99ecb505fcb6348416ca07b939","trusted":true},"cell_type":"code","source":"df_test_x <- df_test %>% select(-Survived)\ndf_test_y <- df_test %>% select(Survived)\npredictions <- predict(bosh.rf, df_test_x)\nglimpse(predictions)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"3db5c5dd-6043-9e3f-be57-b08da4c84749","_uuid":"008781478b2f1e6eed538bca2cc5ac9579b4e9e9"},"cell_type":"markdown","source":"## Merge results to test data frame for analysis ##"},{"metadata":{"_cell_guid":"258aade2-100e-9b07-a84c-92b441d95bff","_uuid":"01ef52f408e92f2956ce326322559b18bd5b61a4","trusted":true},"cell_type":"code","source":"test <- data[(pivot+1):last,] %>%\n            cbind(predictions) %>%\n            arrange(desc(predictions))\nglimpse(test)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"c5dc64f1-d62d-b978-c0cd-7348c7981d51","_uuid":"97439cf62cd45b92d0fb9192d08062a6b6c160e3"},"cell_type":"markdown","source":"## Get the top 20 most probable passengers to survive ##"},{"metadata":{"_cell_guid":"8c687cac-88ba-00ca-6f09-bc5a7ca63cad","_uuid":"d45c5c16743d5d06443110b847e39ef5b510182e","trusted":true},"cell_type":"code","source":"df_top_20_survivals <- df_test %>%\n                cbind(predictions) %>%\n                arrange(desc(predictions)) %>%\n                head(20) %>%\n                select(-predictions)\nglimpse(df_top_20_survivals)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"12d2f644-8a09-2808-f0de-f03cbcb05096","_uuid":"f850fb7236b64e6ef5311fb8fbdfcaa3ed64522d"},"cell_type":"markdown","source":"## Cluster top 20 passenger to interpret results ##"},{"metadata":{"_cell_guid":"482cc535-2bb6-4472-efe8-cd09681ec3f6","_uuid":"4c0b5119e2ebb371a4a5b8c99ef1ca194800e596","trusted":true},"cell_type":"code","source":"clValid(df_top_20_survivals, nClust=2:10, clMethods = \"kmeans\", validation = \"internal\") %>% summary()","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"d9503030-41b2-843c-9fb1-ac13a430dcba","_uuid":"10179806249c1d7371a1cf326116d903337d5402"},"cell_type":"markdown","source":"In the pre-cluster analysis above, Dunn suggests 9 clusters for kmeans while other metric suggest 2 clusters. "},{"metadata":{"_cell_guid":"d0c5f64e-f6e4-2553-14b9-c1ddfcbd872c","_uuid":"e0269256425dc5bb4405d2c4cbd77360c39d5523"},"cell_type":"markdown","source":"## Clustering with kmeans and 9 clusters ##"},{"metadata":{"_cell_guid":"d6aa144b-af32-6753-1638-c965816dcc9c","_uuid":"7f9884b7af91808d8ed06ab86436ee100ba178a7","trusted":true},"cell_type":"code","source":"test.km_9 <- kmeans(df_top_20_survivals, centers = 9, iter.max = 10, nstart = 5)\nprint(test.km_9)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"99b7f5e5-ed5e-3e57-3b0b-073b7a97613b","_uuid":"746b3da6222e364cfc2b583e6743f23bc4b95413"},"cell_type":"markdown","source":"In all centroids above we can note a prevalence of female passengers in 1st or 2nd classes."},{"metadata":{"_cell_guid":"f5be1171-3ed2-cd26-dfb0-7029567d32a8","_uuid":"9500a7f06f6913b758a328ac1f421bad9e1b2517"},"cell_type":"markdown","source":"## Clustering with kmeans and 2 clusters ##"},{"metadata":{"_cell_guid":"96734fbb-9b85-9031-9df1-835578ec39f8","_uuid":"ae5737b6fbc1ff836ffd44b368122357172cec60","trusted":true},"cell_type":"code","source":"test.km_2 <- kmeans(df_top_20_survivals, centers = 2, iter.max = 10, nstart = 5)\nprint(test.km_2)","execution_count":null,"outputs":[]},{"metadata":{"_cell_guid":"ed7d7c05-4a16-c28e-965f-800187ea7d59","_uuid":"85b991fa81cb52e6081525ac190bea502a97e5db"},"cell_type":"markdown","source":"The findings with 2 clusters confirm what was found with 9 clusters. \nAmong survivals there is a prevalence of female passengers around 15 or 36 years from the first class followed by second classes.  No passengers from 3rd class were found among the top survivals.\n\nOther columns are yet to be analysed.\n\n"}],"metadata":{"_change_revision":0,"_is_fork":false,"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}