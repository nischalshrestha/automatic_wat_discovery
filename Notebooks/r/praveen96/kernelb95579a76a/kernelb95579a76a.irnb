{"cells":[{"metadata":{"_uuid":"28e472489810bc0ebcc3da11276599ebfb23ebf6","trusted":false,"_cell_guid":"dfa5d83c-3144-43be-9763-e079991eb3ba"},"cell_type":"code","source":"# This R environment comes with all of CRAN preinstalled, as well as many other helpful packages\n# The environment is defined by the kaggle/rstats docker image: https://github.com/kaggle/docker-rstats\n# For example, here's several helpful packages to load in \n\nlibrary(ggplot2) # Data visualization\nlibrary(readr) # CSV file I/O, e.g. the read_csv function\nlibrary(tidyverse)\nlibrary(randomForest)\nlibrary(rpart)\n# Input data files are available in the \"../input/\" directory.\n# For example, running this (by clicking run or pressing Shift+Enter) will list the files in the input directory\n\nsystem(\"ls ../input\")\n\n# Any results you write to the current directory are saved as output.","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"09b64ab4657c167a11f22a1e430addb7e4aeccca","trusted":false,"_cell_guid":"cc995c0e-4035-4fae-93ae-90d17225be85"},"cell_type":"code","source":"train<-read_csv('../input/train.csv')","execution_count":null,"outputs":[]},{"metadata":{"scrolled":true,"_uuid":"70a115685ffb8af00e6028facf1ba06df7744083","trusted":false,"_cell_guid":"18a81a34-dd3a-4eea-b547-a5bc6c0c9dfb"},"cell_type":"code","source":"head(train)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"44170784935be0a2a44d35ab656eec23c14b69ec","trusted":false,"_cell_guid":"70e38b9d-b9ee-4793-8193-667fae05aa13"},"cell_type":"code","source":"qplot(x=Survived,data=train,binwidth=1)+facet_wrap(~Pclass)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"33b423fb388c41787dc95696eaff7592ed43ff87","trusted":false,"_cell_guid":"d49ec634-eb9a-485e-bde2-11513b3430de"},"cell_type":"code","source":"train$child<-0\ntrain$child[train$Age<=18]<-1\ntrain$child[train$Age>18]<-0","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"4870b0cb55ea07dd40b6f4b2e18fb4ca15f30b5f","trusted":false,"_cell_guid":"9d955c62-7a60-4455-8198-5673bffb5c22"},"cell_type":"code","source":"table(train$child)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"20697db7bad13364dcf3df2dc163c1a767bfc373","trusted":false,"_cell_guid":"8d5af5d7-9c3c-4cb3-ad46-0acdeab8dd9f"},"cell_type":"code","source":"train$child","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2488d5bb6093f7aed8285e0807515112252ef2fc","trusted":false,"_cell_guid":"b5ed5be5-8fb1-4483-826c-2a2ddcb8cf06"},"cell_type":"code","source":"head(train)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"34011f31698a500731225bc087f10d4b909911ac","trusted":false,"_cell_guid":"146d7b73-7eba-4d3f-82ed-084df4872ac1"},"cell_type":"code","source":"sum(is.na(train$Cabin))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7773fc95cc7ac973a7efed562926b71fb36df405","trusted":false,"_cell_guid":"95cf235c-1b89-4fe2-b3f9-fefc0f01f2e1"},"cell_type":"code","source":"sum(is.na(train$Embarked))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"cc856e29fde0de637a1ef60c5fe2a505e4c9daab","trusted":false,"_cell_guid":"789c9e26-5592-4912-9560-183da69c703f"},"cell_type":"code","source":"qplot(x=Embarked,data=train)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"725687c7a7b209a54a71995c4af0538cb922e041","trusted":false,"_cell_guid":"662049c0-29b9-446d-8adc-42b5518583b5"},"cell_type":"code","source":"by(train$Cabin,train$Embarked,summary)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1f7ee029a849afab9920146b6696ec13574fedbd","trusted":false,"_cell_guid":"b22469c8-d3ee-4a02-8f9f-e539ceadbc04"},"cell_type":"code","source":"qplot(x=Age,data=train,binwidth=5,color='red',fill=I('blue'))+facet_wrap(~Survived)+scale_x_continuous(breaks=seq(0,95,1))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1116a3b21c323bb6946c79c9bb2808862e349235","trusted":false,"_cell_guid":"643a2476-e162-4fbe-a2bf-19303d1dc7c4"},"cell_type":"code","source":"table(train$Sex,train$Survived)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a16465445678ef11c593232d8a83d0485abfcb2c","trusted":false,"_cell_guid":"737d3445-3cca-4943-89c5-78e031068ef9"},"cell_type":"code","source":"head(train)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7c732d040e84ec47abdeec0cc484008a5b451163","trusted":false,"_cell_guid":"c0bf8a71-8447-4c6a-ad3a-975d83e02845"},"cell_type":"code","source":"qplot(x=Age,color=Sex,data=train,geom='freqpoly',binwidth=1)+facet_wrap(~Survived)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e00c58b5b3b8f3af70c696db5ae18ca7b5134f14","trusted":false,"_cell_guid":"fa11d4c6-28d4-4415-8311-7a59c1877b00"},"cell_type":"code","source":"qplot(x=Age,color=Sex,data=train,geom='freqpoly',binwidth=1)+facet_wrap(~Embarked)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a7bbeda1a1df969fa6bc9a5a35e90c80d96875cb","trusted":false,"_cell_guid":"5c5145f2-85ab-44e2-82f8-9d4e98543a6b"},"cell_type":"code","source":"qplot(x=Survived,color=Sex,data=train,geom='freqpoly',binwidth=1)+facet_wrap(~Embarked)","execution_count":null,"outputs":[]},{"metadata":{"scrolled":true,"_uuid":"ed6135fcb5cc8b260ad827d750ae6284544b7f84","trusted":false,"_cell_guid":"f6367155-fd4f-4f0f-bba3-96b07a885f70"},"cell_type":"code","source":"train %>% filter(train$Cabin=='B28')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1352091ba58032777a617b8fbb8ae386d8b66816","trusted":false,"_cell_guid":"e86faacf-3676-435d-9a2d-f2cdb013f6ae"},"cell_type":"code","source":"train %>% filter(train$Cabin=='B30')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e73007c66d016cecb90f3ebdb794b31773f54727","trusted":false,"_cell_guid":"ea94d992-e287-4622-b8fb-802dd5a8fba3"},"cell_type":"code","source":"qplot(x=Fare,data=train)+facet_wrap(~Embarked)+scale_x_continuous()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5cd31e740f7b471e3b167093cd550255ef732a84","trusted":false,"_cell_guid":"5689199d-a5fc-4816-bc37-bbe9ae082c5d"},"cell_type":"code","source":"qplot(x=Fare,data=train)+facet_wrap(~Pclass)+scale_x_continuous()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"c672bf0c9ecce56d1a7bf164d4f7dd097692a207","trusted":false,"_cell_guid":"ba3fa2ac-5004-4bbc-92ee-2ee82fcbf9e2"},"cell_type":"code","source":"train$Embarked[is.na(train$Embarked=='NA')]<-'S'","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"204aa947bea070d5b43825d54bd519c5ebcc7f4b","trusted":false,"_cell_guid":"97438cdd-0ac6-4e83-aca2-14b6b06bd103"},"cell_type":"code","source":"train %>% filter(train$Cabin=='B28')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"b76c7def9f6da5384d3d08639782844ee2c1748c","trusted":false,"_cell_guid":"576c2036-eff9-481e-acbc-2238258c1424"},"cell_type":"code","source":"sum(train$Embarked=='NA')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"fb6c0b80369ba529e69d71afdb0c4d470bd8721a","trusted":false,"_cell_guid":"8ef11b7b-f54c-404d-8ccb-c51e08ebee53"},"cell_type":"code","source":"sum(is.na(train$Embarked))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5d196e6d3d4eea01b27d576d36f06a0775067339","trusted":false,"_cell_guid":"ced4502f-494d-48e2-a42b-78a3f8f73166"},"cell_type":"code","source":"head(train)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"83ec812f722626e48c49096ee7b26eaa4bee8ebc","trusted":false,"_cell_guid":"1d5b8729-06fb-47b8-ba34-ec7c7dbbfb01"},"cell_type":"code","source":"sum(is.na(train$Age))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"cc82100fc68c0ef95a18009deb6fd4792007c968","trusted":false,"_cell_guid":"9e97d599-c50e-4e04-896c-eeb263a94d83"},"cell_type":"code","source":"train$familysize<-train$SibSp+train$Parch+1","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"b535d59c716ae5897d012d365c1e5010673a1031","trusted":false,"_cell_guid":"87b130fb-aea6-4850-ac3e-35df29798764"},"cell_type":"code","source":"qplot(x=familysize,data=train,binwidth=1,color='red')+facet_wrap(~Survived)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5fd35036862a973cb068fa78c75f324ece6ce7d0","trusted":false,"_cell_guid":"7ad6b908-d141-4853-8ff3-694efb186844"},"cell_type":"code","source":"library(dplyr)\nfull<-bind_rows(train,test)\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2b50716649d36b22bb293e948967a7275217585e","trusted":false,"_cell_guid":"d3dc732b-f3b9-47df-83ef-e672925cdea8"},"cell_type":"code","source":"test<-read_csv('../input/test.csv')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"166cf88cf363e19040f30fae5857f37a32643986","trusted":false,"_cell_guid":"52d524b7-2626-4755-839e-1e921b7889f3"},"cell_type":"code","source":"full<-bind_rows(train,test)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"6bd5bde1a9c9dfd7e2f2cb8d9910d618c3c55f2c","trusted":false,"_cell_guid":"047cd478-9376-4d19-b2a9-c2ca72f728c0"},"cell_type":"code","source":"sum(is.na(full$Age))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0fea7b330e4c826e2f8bed5c409777b5469f81e8","trusted":false,"_cell_guid":"b6f9a7d3-2651-4c6d-8205-8519277199b4"},"cell_type":"code","source":"factor_vars <- c('PassengerId','Pclass','Sex','Embarked','familysize')\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"85e6ab17083c99ae019fa9583b0533342fadec09","trusted":false,"_cell_guid":"16ccc2c8-e982-4304-bf9d-6c98ad3bf7e8"},"cell_type":"code","source":"full$familysize<-full$SibSp+full$Parch+1","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0b495b651e9e2a375697dc64acfa129e0242cff1","trusted":false,"_cell_guid":"e2299c56-8c04-461a-bd01-c9c9df5125b3"},"cell_type":"code","source":"library('mice')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"dc7d8db82a52d47dab289093efd73254325ab6c6","trusted":false,"_cell_guid":"278e70c5-fe9b-451f-aa5e-cbda7754d789"},"cell_type":"code","source":"full[factor_vars] <- lapply(full[factor_vars], function(x) as.factor(x))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"785478f0b6f6cacc584ed4346d06492ec107649d","trusted":false,"_cell_guid":"138bac0f-d269-41d7-ab5e-092b660a0137"},"cell_type":"code","source":"set.seed(129)\nnames(full)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"6be913c07627a053df22a142cd82df9858628e9d","trusted":false,"_cell_guid":"ef3212c0-2ab6-4891-a4e8-c2b497e8ef89"},"cell_type":"code","source":"mice_mod <- mice(full[, !names(full) %in% c('PassengerId','Name','Ticket','Cabin','Family','Surname','Survived','child')], method='rf') ","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"08f0dd334f64a5bea51bee59e3c29841006c83fa","trusted":false,"_cell_guid":"c82ce30e-3f8e-491f-b101-36587fc3a61b"},"cell_type":"code","source":"mice_output <- complete(mice_mod)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d910bffbbc4c51e05cc6febd335f7d7452046e9c","trusted":false,"_cell_guid":"93b9b3fe-7c81-4d5f-9043-743b06e1e570"},"cell_type":"code","source":"hist(full$Age, freq=F, main='Age: Original Data', \n  col='darkgreen', ylim=c(0,0.04))\nhist(mice_output$Age, freq=F, main='Age: MICE Output', \n  col='lightgreen', ylim=c(0,0.04))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"6964544c8a05898aaf1086d271ad64e0f9b12ff0","trusted":false,"_cell_guid":"099014ab-b4e3-499e-96b0-3634871304db"},"cell_type":"code","source":"head(full)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"574f83ad040085aff702f325937d4610db76770c","trusted":false,"_cell_guid":"83f1911d-5c52-4ba4-bfa6-97324e4c1a19"},"cell_type":"code","source":"is.na(mice_output$Age) %>% sum()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a939e2bc3e030016ce13ed5c387e64fe02d6ca9d","trusted":false,"_cell_guid":"607b34a9-05a1-4e25-9229-4a8f8c4a3861"},"cell_type":"code","source":"full$Age<-mice_output$Age","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1015a33d7c54b77cfda5603e8d57224f77f6f0eb","trusted":false,"_cell_guid":"81b95788-f68b-4264-bf26-3ff1eab73d2f"},"cell_type":"code","source":"head(mice_output)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d5a9e3f81f3399c33f3f06d3ecb0a43c6326f2cd","trusted":false,"_cell_guid":"6179160a-e0c5-4075-9f71-534044cea0eb"},"cell_type":"code","source":"is.na(full$SibSp) %>% sum()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"b40bf01754f954a692a802fab0af08b67f16ebcd","trusted":false,"_cell_guid":"c837b325-137d-43e7-9a62-c7eeed61ca0d"},"cell_type":"code","source":"is.na(full$Parch) %>% sum()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"4d1c1b25f5b623f19dc4541992a673b1c154d1b6","trusted":false,"_cell_guid":"c4ee1490-31c7-4dc9-8393-e75d7438a4b0"},"cell_type":"code","source":"is.na(full$Fare) %>% sum()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"c181cb0f0d18e15415ec8e16a904aaa3f79f0686","trusted":false,"_cell_guid":"5b6c5b7c-b377-466a-9c04-fb91a7fa9d93"},"cell_type":"code","source":"is.na(full$Embarked) %>% sum()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"13014e3c824d77d1dc2f6b625707a15eb672ac70","trusted":false,"_cell_guid":"20884224-876a-4d65-8c53-094eabfb8056"},"cell_type":"code","source":"is.na(full$familysize) %>% sum()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"6b32ed4906d4499dc86a110b0ef6dba60d03aac0","trusted":false,"_cell_guid":"6f23f123-b868-4f53-b1e3-9407188b1944"},"cell_type":"code","source":"is.na(mice_output$Pclass) %>% sum()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"55d97c2129daa53f96bedebefb5fce8217544b8f","trusted":false,"_cell_guid":"919bd780-f182-4de6-adec-58f54d46571b"},"cell_type":"code","source":"is.na(mice_output$Embarked) %>% sum()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e535f625e34ec55d873a878b2f43e51798383050","trusted":false,"_cell_guid":"6c13009a-6750-49da-8f15-68c0d8a91c31"},"cell_type":"code","source":"full$Embarked<-mice_output$Embarked","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"c52046039493e78cdc7e7db512459edaf057c68f","trusted":false,"_cell_guid":"1d7d02b9-d18f-474c-a04d-3f6ea641cf87"},"cell_type":"code","source":"full %>% filter(!(full$Fare==mice_output$Fare))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"fd3750a9330b73e300cbaba8c3f407c7208a575f","trusted":false,"_cell_guid":"158c9322-e3f2-4ceb-a11a-021e584e8830"},"cell_type":"code","source":"full$Fare<-mice_output$Fare","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"392ebda053aa839870dfb84415e1d8dc110723d5","trusted":false,"_cell_guid":"ca8cc6dd-0c36-4e8c-964d-a3766fc72c2d"},"cell_type":"code","source":"head(full)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"73dcc9f2956728689f77c8014e353fc48e33a9d8","trusted":false,"_cell_guid":"4a566a0d-9508-44eb-8b5d-55c509858e06"},"cell_type":"code","source":"train <- full[1:891,]\ntest <- full[892:1309,]\nset.seed(754)\n\n\n\n\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"67e0cd414a84126c7d0a36b17e3352f2f157ba35","trusted":false,"_cell_guid":"733e3365-69be-4795-b93b-60339c8db459"},"cell_type":"code","source":"rf_model <- rpart(Survived ~ Pclass + Sex + Age + child + Parch + Fare,method=\"class\" ,data = train)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2f843741874b973b52957acd00b11b769550fecb","trusted":false,"_cell_guid":"450563ea-b2cf-45f4-9e91-218dc50d84b4"},"cell_type":"code","source":"prediction <- predict(rf_model,newdata= test,type=\"class\")","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e0904adfdeaea76ef01b86a86a446917db575b87","trusted":false,"_cell_guid":"3a6763aa-c892-404b-9e70-a5a1f52e6fa5"},"cell_type":"code","source":"solution <- data.frame(PassengerID = test$PassengerId, Survived = prediction)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a74c6dc855aab2769045ab405e306e4e5a54042d","trusted":false,"_cell_guid":"ccc7a58b-ae8a-4388-966e-46030efcb30a"},"cell_type":"code","source":"write.csv(solution, file = 'randomforestSolution.csv', row.names = F)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a28951faff685eca814e6636cccb3d315d509a1f","trusted":false,"_cell_guid":"d189b845-fa2a-46f3-a43b-e0e2fc3487ad"},"cell_type":"code","source":"rf_model","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"369f6953f3a6e369ca032f207af7c8e8bdd576f9","trusted":false,"_cell_guid":"7bafc311-5f64-418a-b5ed-c5b3b4b9a227"},"cell_type":"code","source":"ls()","execution_count":null,"outputs":[]},{"metadata":{"scrolled":true,"_uuid":"a01eef9f635b29be229c414269daf4013c1ed6af","trusted":false,"_cell_guid":"97d94550-db5c-4e4d-b439-edba13d53f9c"},"cell_type":"code","source":"prediction","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e2814bb4902492887bc37b5e67ec963ee2b120c6","trusted":false,"_cell_guid":"0bdc7864-159d-4750-ac9e-03e468562ee8"},"cell_type":"code","source":"head(train)\nhead(test)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"c84b89f10e05a05c66453d335f93f3bc5639054f","trusted":false,"_cell_guid":"ce0cbcd1-4064-405e-9541-221a6bcfea3c"},"cell_type":"code","source":"open(randomforestSolu)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2283c8719b5b594852fc5bdb3d1f6f12e3023a03","trusted":false,"_cell_guid":"372df7dd-e689-4424-9d3c-64632f3c66ce"},"cell_type":"code","source":"","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","version":"3.4.2","name":"R","pygments_lexer":"r","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}