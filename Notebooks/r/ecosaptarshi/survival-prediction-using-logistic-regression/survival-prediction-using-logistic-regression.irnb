{"cells":[{"metadata":{"_uuid":"3c0faad33fcf1c9222e2732b20e67957cb28a189","_execution_state":"idle","trusted":true},"cell_type":"code","source":"###LIBRARY\nlibrary(caret)\nlibrary(ggplot2)\nlibrary(MASS)\nlibrary(car)\nlibrary(mlogit)\nlibrary(sqldf)\nlibrary(Hmisc)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"1fa67020c1b7154add830ce7c6ccc854eb0fe702"},"cell_type":"code","source":"######## IMPORTING THE DATA SETS \ndata<-read.csv('../input/train.csv')\ndata1<-read.csv('../input/test.csv')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"263ecb9b72d7997334efe8f7d70ea10f5112e9b9","scrolled":false},"cell_type":"code","source":"##### DATA STRUCTURE ##############\nstr(data)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"d362dc6e01a7c03bf2b8cc0954013857a2309168"},"cell_type":"code","source":"###change to factor\ndata$Survived<-as.factor(data$Survived)\ndata$Pclass<-as.factor(data$Pclass)\ndata$SibSp<-as.factor(data$SibSp)\ndata$Parch<-as.factor(data$Parch)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"d3a6c0574cb494fdf4e6ac0ab113967436202bb2"},"cell_type":"code","source":"###drop cabin column\ndata$Cabin<-NULL","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"2486206decc247c9d4ed8ebf20d1629b174f280d"},"cell_type":"code","source":"###missing value \nsapply(data, function(x) sum(is.na(x)))\ndata<-na.omit(data)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"d172556ba8778a0234c8519f105c8a3d44a8aaf8"},"cell_type":"code","source":"###outlier detection\nsummary(data)\nboxplot(data$Age)\nquantile(data$Age,c(0,0.01,0.05,0.10,0.20,0.25,0.30,0.35,0.40,0.45,0.50,0.60,0.75,0.80,0.85,0.90,0.95,0.99,0.995,1))\ndata<-data[data$Age < 55.8 ,]\n##\nboxplot(data$Fare)\nquantile(data$Fare,c(0,0.01,0.05,0.10,0.20,0.25,0.30,0.35,0.40,0.45,0.50,0.60,0.75,0.80,0.85,0.90,0.95,0.99,0.995,1))\ndata<-data[data$Fare <56.92920   ,]  ","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"72907c2f3b088b4c44823f8cade46a54c220a9da"},"cell_type":"code","source":"###MODEL\nnames(data)\nmodel<-glm(Survived~Pclass+Sex+Age+SibSp+Parch+Fare+Embarked,data=data, family=binomial())\nsummary(model)\nmodel<-glm(Survived~Pclass+Sex+Age+SibSp+Fare+Embarked,data=data, family=binomial())\nsummary(model)\nmodel<-glm(Survived~Pclass+Sex+Age+SibSp+Fare,data=data, family=binomial())\nsummary(model)\nmodel<-glm(Survived~Pclass+Sex+Age+SibSp,data=data, family=binomial())\nsummary(model)\nmodel<-glm(Survived~Pclass+Sex+Age+I(SibSp==3)+I(SibSp==4),data=data, family=binomial())\nsummary(model)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"e0f7a0a8b5cfe7bed5a73eb668a031037fdd478c"},"cell_type":"code","source":"###MULTICOLLINEARITY\nvif(model)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"b5a9b9c59ea0d84bed669244fa753e7105e6956e"},"cell_type":"code","source":"###R SQUARE\nmodelChi <- model$null.deviance - model$deviance\n#Finding the degree of freedom for Null model and model with variables\nchidf <- model$df.null - model$df.residual\nchisq.prob <- 1 - pchisq(modelChi, chidf)\nR2.hl<-modelChi/model$null.deviance\nR.cs <- 1 - exp ((model$deviance - model$null.deviance) /nrow(data))\nR.n <- R.cs /(1-(exp(-(model$null.deviance/(nrow(data))))))\nR.n ## ranges from 0 to 1; closer to 1 better ","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"8e64bb0198ae73e07484b183f22861d3f51d40f9","scrolled":true},"cell_type":"code","source":"# Predicted Probabilities\nprediction <- predict(model,newdata = data,type=\"response\")\nlibrary(pROC)\nrocCurve   <- roc(response = data$Survived, predictor = prediction, \n                  levels = rev(levels(data$Survived)))\ndata$Survived <- as.factor(data$Survived)\n#Metrics - Fit Statistics\npredclass <-ifelse(prediction>coords(rocCurve,\"best\")[1],1,0)\nConfusion <- table(Predicted = predclass,Actual = data$Survived)\nAccuracyRate <- sum(diag(Confusion))/sum(Confusion)\nGini <-2*auc(rocCurve)-1\nAUCmetric <- data.frame(c(coords(rocCurve,\"best\"),AUC=auc\n                          (rocCurve),AccuracyRate=AccuracyRate,Gini=Gini))\nAUCmetric <- data.frame(rownames(AUCmetric),AUCmetric)\nrownames(AUCmetric) <-NULL\nnames(AUCmetric) <- c(\"Metric\",\"Values\")\nAUCmetric\n\nConfusion \nplot(rocCurve)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"dfb6b40f8c5365d60b80947b05dcc5383d72cca2"},"cell_type":"code","source":"### KS statistics calculation\ndata$m1.yhat <- predict(model, data, type = \"response\")\nlibrary(ROCR)\nm1.scores <- prediction(data$m1.yhat, data$Survived)\nplot(performance(m1.scores, \"tpr\", \"fpr\"), col = \"red\")\nabline(0,1, lty = 8, col = \"grey\")\nm1.perf <- performance(m1.scores, \"tpr\", \"fpr\")\nks1.logit <- max(attr(m1.perf, \"y.values\")[[1]] - (attr(m1.perf, \"x.values\")[[1]]))\nks1.logit # Thumb rule : should lie between 40% - 70%\n## It ranges from 0 ","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"31af7bfc35c03fd92359aaa607c51a707c4c7442"},"cell_type":"code","source":"####################################### TEST DATA SET ###########################################\nstr(data1)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"b04a5e9df1fa61e3908431cdd73dced62b103383"},"cell_type":"code","source":"###change to factor\ndata1$Pclass<-as.factor(data1$Pclass)\ndata1$SibSp<-as.factor(data1$SibSp)\ndata1$Parch<-as.factor(data1$Parch)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"91474ac53a73d84848c9f40d5c12df8b408c57f1"},"cell_type":"code","source":"###drop cabin column\ndata1$Cabin<-NULL","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"b6ad0b00580c1409efef29be57b75c25792887a2"},"cell_type":"code","source":"###missing value \nsapply(data1, function(x) sum(is.na(x)))\n############### taking mean age for missing values in age column #######################       \ndata1$Age[is.na(data1$Age)]<-round(mean(data1$Age,na.rm=TRUE))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"88e57e96806494df9c51dac9ac96f67859eabe60"},"cell_type":"code","source":"# Predicted Probabilities\nprediction1 <- predict(model,newdata = data1,type=\"response\")\ndata1$m1.yhat <- predict(model, data1, type = \"response\")\ndata1$Survived <- as.numeric( prediction1 >= 0.5)\ntable(data1$Survived)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"a446b6f01d4b864e730dbb7e97e82d3cea37e1c3"},"cell_type":"code","source":"result<-data.frame(data1$PassengerId)\nnames(result)[1]<-\"PassengerId\"\nresult$Survived<-data1$Survived\nresult","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}