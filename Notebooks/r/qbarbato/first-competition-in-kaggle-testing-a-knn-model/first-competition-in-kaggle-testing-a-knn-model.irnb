{"cells":[{"metadata":{"_kg_hide-output":false,"_uuid":"c996c69aa2e5ddd163eace96796eb458d36469e9"},"cell_type":"markdown","source":"**Loading libraries**"},{"metadata":{"_uuid":"71bf4c59fd854861569b8f7e1c95070353c56d3f","_execution_state":"idle","trusted":true},"cell_type":"code","source":"library(class)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(fastDummies)\nlibrary(caret)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"15eb2ff50167afeaa6db3f9875dce543fd5b5f81"},"cell_type":"markdown","source":"**Explore data**"},{"metadata":{"trusted":true,"_uuid":"d0c9ce3947a63fef578ca00d217e6cc9119258e4"},"cell_type":"code","source":"df_full <- read.csv(\"../input/train.csv\")\ndf <- df_full %>% \n    select(Age,Sex, Pclass, Survived) %>%\n    mutate(Pclass = as.factor(Pclass), Sex = as.factor(Sex),Survived = as.factor(Survived))\nhead(df)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"fe502dabca8cc757b84755991c7d05e9e37f9bf8"},"cell_type":"code","source":"ggplot(df, aes(x = Sex, y = Age, color = Survived)) +\n  geom_jitter() + \n  facet_grid(.~Pclass)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"a2a80944aa86c6751724ab9bda7c1cb254d8ea8c"},"cell_type":"code","source":"sum(is.na(df$Age))\nsum(is.na(df$Sex))\nsum(is.na(df$Pclass))\ndf2 <- df %>%\n  mutate(Age = ifelse(is.na(Age),mean(Age,na.rm = TRUE),Age))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"adcb09eb2d7cff0abce2a6c1780f2811b6487ec3"},"cell_type":"markdown","source":"**Adapt variables for knn**"},{"metadata":{"trusted":true,"_uuid":"b4a5d4e2052236b24fa54e73d5c437dd978e0d0a"},"cell_type":"code","source":"df2_adapted <- df2 %>%\n    mutate(Is_Male = ifelse(Sex == \"male\",1,0),\n           Pclass = (as.numeric(Pclass)),\n           Is_Adult = ifelse(Age > 15, 1, 0)) %>%\n    select(Survived,Is_Adult, Is_Male, Pclass)\n\ndf2_scaled <- df2_adapted\ndf2_scaled[,5:7] <- dummy_cols(df2_adapted$Pclass) %>%\n    select(data_1,data_2,data_3)\nhead(df2_scaled)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"c2394f20fbe074f05c2c24aba4cb62ae973de2fa"},"cell_type":"markdown","source":"**Spliting dataset into train and test**"},{"metadata":{"trusted":true,"_uuid":"e60815414e95b6b3379161b41587cfa3b0f8f20e"},"cell_type":"code","source":"ind <- sample(nrow(df2_scaled),nrow(df2_scaled)*0.50)\ndf2_train <- df2_scaled[ind,]\ndf2_test <- df2_scaled[-ind,]\nhead(df2_test)\nhead(df2_train)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"efd259831870aa1e2f77fb689a344f81df2c0d89"},"cell_type":"markdown","source":"**Finding the best k**"},{"metadata":{"trusted":true,"_uuid":"c2c22a48bff6d418562bb55a657eda112165f056"},"cell_type":"code","source":"trControl <- trainControl(method  = \"cv\",\n                          number  = 5)\nfit <- train(Survived ~ .,\n             method     = \"knn\",\n             tuneGrid   = expand.grid(k = 1:15),\n             trControl  = trControl,\n             metric     = \"Accuracy\",\n             data       = df2_train)\nfit","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"dd55e9d393b480432a7ee55168e2f5d254e8efa3"},"cell_type":"markdown","source":"**Testing my performance**"},{"metadata":{"trusted":true,"_uuid":"5a8520efe78c9d70203faaa99d80f58c8e30ab34"},"cell_type":"code","source":"knn_model <- knn(train = df2_train[,-1],\n                 test = df2_test[,-1],\n                 cl = (df2_train[,1]),\n                 k=5) \nhead(knn_model)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"e0508a1e7c68df83a78818d98e4cca6244e2c0a8"},"cell_type":"code","source":"mean(df2_test[,1] == knn_model)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"cbc6b6fed64196e0b4d114ae41b2e23de7d3e1bd"},"cell_type":"markdown","source":"**Making the real test**"},{"metadata":{"trusted":true,"_uuid":"d45c12e839e0c25868c38acf4e72380363c41a36"},"cell_type":"code","source":"df_real_test <- read.csv(\"../input/test.csv\")\ndf_real <- df_real_test %>%\n    mutate(Is_Male = ifelse(Sex == \"male\",1,0),\n           Pclass = (as.numeric(Pclass)),\n           Is_Adult = ifelse(Age > 15 | is.na(Age), 1.0, 0)) %>%\n    select(Is_Adult, Is_Male, Pclass)\ndf_real_scaled <- df_real\ndf_real_scaled[,4:6] <- dummy_cols(df_real$Pclass) %>%\n    select(data_1,data_2,data_3)\nhead(df_real_scaled)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"9d1025bd4fb18e726729d9da60eb72bfdbeceb15"},"cell_type":"markdown","source":"**Output**"},{"metadata":{"trusted":true,"_uuid":"efedca7166af4157fd2bb7fed0d6f6a169aa1290"},"cell_type":"code","source":"knn_predicted <- knn(train = df2_train[,-1],\n                 test = df_real_scaled,\n                 cl = (df2_train[,1]),\n                 k=5) \nknn_predicted <- ifelse(knn_predicted == 1,1,0)\nprediction <- data.frame(PassengerId = df_real_test$PassengerId,\n                         Survived = knn_predicted)\nhead(prediction)\nwrite.csv(prediction,\"submission.csv\",row.names = FALSE)\nprint(\"Output is saved\")","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"27cd7bc45ba143201a88a214f9b68aee95e0a210"},"cell_type":"markdown","source":""},{"metadata":{"_uuid":"ef6bd1d86c2fd8e6a00ab3fa25fe3fff372544b8"},"cell_type":"markdown","source":""},{"metadata":{"_uuid":"d90eaa929e810645f26ac7240d6b2a47c2e46a63"},"cell_type":"markdown","source":""}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}