{"cells":[{"metadata":{"_uuid":"af753ea0f31d6c46a90d4812b265a071e1bb06bf","_cell_guid":"7f552e65-2353-4989-904c-591ae723bf0d"},"cell_type":"markdown","source":"# What about the Parents? My Path to Top 4%"},{"metadata":{"_uuid":"f2e8427357716cef9aa6a0892a03d4afccae6c8e","_cell_guid":"ac94fde7-749f-49ec-a99a-badfd72534ba"},"cell_type":"markdown","source":"This is my first Kaggle Kernal. I explored the Titanic Data Set to see what attributes predict Survival among the Passengers. \n\nI had a lot of fun digging into the data. I noticed that children were likely to survive, so I wondered if their parents were likely to survive too. Especially the few babies on board, they were in their Moms or Dads arms when put onto a life boat, right? What I found might surprise you, it certainly surprised me.\n\nThis path led to me to a Prediction Score of 81.81% after several tries (I noticed improving my cross-validation score wasn't a good predictor of improving my test-score, so I admit to checking my models against the test set repetedly). Top 4% on my first Kaggle! Not bad!\n\nI had fun making this notebook (though I struggled with the kaggle kernal not autosaving my work and lost a few hours). \nIts written in R with heavy use of the dplyr andd ggplot faceted plots.\n\nThere are still things I'm trying to improve, but I wanted to publish this version that led to my current high score.\n\nI'd love to hear from you with any comments or questions. I'm just getting started in Machine Learning but experienced in Statistics and Data Analysis. So any tips on how to apply the Machine Learning are especially great to hear."},{"metadata":{"_uuid":"f2baf27bd2c1f86856e04c25a6b0d0d71704d609","trusted":false,"_cell_guid":"cff3d488-2f08-46c2-9c2c-9ef230edcf5a"},"cell_type":"code","source":"# Import Libraries\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(readr)\nlibrary(GGally)\nlibrary(caret)\nlibrary(rpart)\nlibrary(randomForest)\nlibrary(stringr)\nlibrary(repr)\n","execution_count":null,"outputs":[]},{"metadata":{"scrolled":true,"_uuid":"8fa56132028408e2ce39e9ce9efaf8489eb9f360","trusted":false,"_cell_guid":"93721b8f-bf40-4cb7-8d71-e545d59b0f97"},"cell_type":"code","source":"# Import data\ntrain <- read_csv('../input/train.csv');\ntrain$Partition='train'\n\ntest <- read_csv('../input/test.csv');\ntest$Partition='test'\ntest$Survived=0\n\n\n#Partition into Training and Cross-Validation\ntrainp = 1\nset.seed(420)\nInTrain = createDataPartition(y=train$Survived, p = trainp, list=FALSE)\ntrain[-InTrain,'Partition']='cross'\n\ntitanic=rbind(train,test )","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"4e94576889ab15bd7abf0a12bcaf84ec934c91ba","_cell_guid":"ad5a6aa5-5273-4a6b-9540-26c1d9d92041"},"cell_type":"markdown","source":"## First Glimpse\n\nTake a glimpse at the data."},{"metadata":{"_uuid":"93e164e8cd66f9d8e19d5a5b994fa9b9b332ea2e","trusted":false,"_cell_guid":"e466aafb-d2b4-450b-94b5-7c71e2e4a1a5"},"cell_type":"code","source":"titanic %>% select_if('is.character') %>% head()\ntitanic %>% select_if('is.numeric') %>% summary()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"9b5971acc08a5db0bdfc90f91bf4c080023f4883","_cell_guid":"d9a708da-c2b0-4536-93f4-bf6fe1192c37"},"cell_type":"markdown","source":"Some of the variables are better coded as Factor Variables."},{"metadata":{"_uuid":"c4ce3b5b55c1081cfa1f4e4aaefd76f9fd1b3d37","trusted":false,"_cell_guid":"9f15e958-4d81-42d1-b991-c73f7f8cd67d"},"cell_type":"code","source":"# Mutate variables into Factors, including add an \"AgeGroup\"\ntitanic = titanic %>% mutate(Survived=as.factor(Survived),\n                    Sex=factor(Sex, labels=c('female','male')),\n                   AgeGroup=as.ordered(case_when(\n                           Age< 2 ~ 'Baby',\n                           Age< 13 ~ 'Child',\n                           Age< 34 ~ 'Young Adult',\n                           Age< 60 ~ 'Older Adult',\n                           Age>=60 ~ 'Elderly',\n                           is.na(Age) ~ 'Unknown')),\n                   HasCabin=as.factor(if_else(is.na(Cabin),0,1)),\n                   Pclass=as.factor(Pclass),\n                   AgeMissing=as.factor(if_else(is.na(Age),1,0)),\n                   Embarked=as.factor(Embarked))\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2b2ee561fd109a2b7d1a0f40b7ee7aed358b2478","_cell_guid":"de85ce6b-abd5-4a34-a4ad-9cbf61b1ebea"},"cell_type":"markdown","source":"Replace missing values Fare and Embarked with the most frequent."},{"metadata":{"_uuid":"b376899f9bc1d5c55b240090b06a1ceee3ff35ee","trusted":false,"_cell_guid":"91f07760-6118-48c8-81b6-248f8c0bf385"},"cell_type":"code","source":"# Fill in missing Fare, Only 1 in test set. \ntitanic[is.na(titanic$Fare),'Fare'] = 0\n\n# Fill in missing Embarked with most common\ntitanic[is.na(titanic$Embarked),'Embarked'] = 'S'\n\ntitanic %>% select_if('is.numeric') %>% summary()\ntitanic %>% select_if('is.factor') %>% summary()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"35cbb3390adff879809d9a9f3d8a5ab5d3b2838e","_cell_guid":"05e3a67a-cf14-4b4d-bbe1-907abe458fb2"},"cell_type":"markdown","source":"## Parse Name for Title\n\nThe name field carries a lot of information, including indication of Age.\n \nI parse name into seperate fields and convert Title from a character to factor variable. I combine some of the rare titles into categories including \"Military\" titles and \"Honorary\" titles. Mlle and Mme are French versions of Miss and Mrs, so they are combined with the English versions."},{"metadata":{"collapsed":true,"_uuid":"90a1ebc9bec7682581335f5a03dc47af0ade3aa4","trusted":false,"_cell_guid":"532893dc-548d-4634-8a34-023e1651ba98"},"cell_type":"code","source":"# Parse Name into Surname, First Names, Other Names\ntitanic$surname = str_extract(titanic$Name,'(.*,)') %>% str_replace_all(',','')\ntitanic$firstnames = str_replace_all(titanic$Name,'(.*\\\\. )|(\\\\(.*)','')\ntitanic$othernames=str_extract(titanic$Name,'\\\\(.*\\\\)') %>% str_replace_all('\\\\(','')%>% str_replace_all('\\\\)','')\n\n# Parser title and make into Factor, replace Rare Titles with more common or lump together\ntitanic$title = str_replace_all(titanic$Name,'(.*, )|(\\\\..*)','') %>% \n  str_replace_all('Capt|Col|Major','Military') %>% \n  str_replace_all('Don$|Dona|Jonkheer|Lady|Sir|the Countess','Honorary') %>% \n  str_replace_all('Mlle|Ms','Miss') %>% \n  str_replace_all('Mme','Mrs') %>% as.factor()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"15ef49c35a39c1d50498162fb2357c19bc37d69d","_cell_guid":"b2706964-1e7c-4aad-a28a-a68efa3be988"},"cell_type":"markdown","source":"Now I use the Title to help fill in missing Age Data. I find the average age for each title and then fill in missing values. This is accomplised by joinning tables by title and then replacing NAs with the Average Age for each title"},{"metadata":{"_uuid":"4fb676fd5a81ab78362d2604c66c16476fc9fced","trusted":false,"_cell_guid":"e9ffa76c-b93a-4c6f-90d2-a158f5213fbf"},"cell_type":"code","source":"# Find average age for each title\nagebytitle = titanic %>% group_by(title) %>% summarise(count=n(), avgage=median(Age, na.rm=T))\nagebytitle\n\n# Join the agebytitle table with titanic, adds avgage column\ntitanic = titanic %>% left_join(agebytitle, by='title')\n\n# Where age is missing replace with avgage\ntitanic[is.na(titanic$Age),'Age']=titanic[is.na(titanic$Age),'avgage']\n\n# Delete the avgage column form the main data table\ntitanic = titanic %>% select(-avgage)\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d298b576a0379900ac30c2c694c7123fb040d149","_cell_guid":"27609b06-4759-4c42-aad9-4e6d5203ecdf"},"cell_type":"markdown","source":"## Pairplots & Exploration\n\nPairplots allow for quick exploration of the data to see what predictors appear most related to survival. They can also help spot correlated predictor variables, outliers, and other data problems.\n\nThe following pairplots show the relationship between each variable. The color-aesthetic is mapped to \"Survived\" so blue indicates passengers who survived, red is passengers who did not survive. I am careful to only visualize the Training data leaving out the Cross-Validation and Testing."},{"metadata":{"_uuid":"234f5323f21d4cfd66c53aa577cdea0115b47ddc","trusted":false,"_cell_guid":"de9f9b83-cab4-4d0b-b5c1-0b451716daf6"},"cell_type":"code","source":"train = titanic %>% filter(Partition=='train')\ncross = titanic %>% filter(Partition=='cross')\ntest = titanic %>% filter(Partition=='test')\n\noptions(repr.plot.width=8, repr.plot.height=8)\n#library(GGally)\ntrain %>% select(Survived,Pclass,HasCabin,Sex,Age,title,Embarked) %>%\n        ggpairs(title = 'Survival on Titanic',\n               mapping = aes(colour = Survived),\n                lower=list(combo=wrap(\"facethist\",binwidth=10)))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"413098987f3f240cede6ecfa218dd28cea0985d3","_cell_guid":"610d3606-be2d-4542-806e-2e94562e9be6"},"cell_type":"markdown","source":"Above in the pairplot are the vartiables I thought would be most related to Survival. Some things I notice:\n\n- Survival appears most related to Sex and Passenger Class.\n- Females and 1st and 2nd class passengers were more likely to survive.\n- Surivors were more likely to have a cabin.\n- Average age of the survivors is slightly lower, but there is large variability in Age for both groups.\n- Title appears to be a good predictor of Survival. Title caries a variety of information including Sex, Age and other important social constructs. It appears to make a good predictor of Survival.\n- Passenger Class is a confounding variable for most of the other variables. In particular, third class passengers are more likely to be male, younger, and are far less likely to have a cabin (though a few actually do!)\n\nNext, the pairplot for several more variables:"},{"metadata":{"_uuid":"9807d69cc4e5c7a5023731104c4728df51a9c943","trusted":false,"_cell_guid":"8421a396-d7e7-490f-a930-39a446cb8210"},"cell_type":"code","source":"train %>% select(Survived,Fare,SibSp,Parch,AgeMissing,Pclass,Sex) %>% \n    ggpairs(title = 'Survival on Titanic',\n                mapping = aes(colour = Survived),\n                lower=list(combo=wrap(\"facethist\",binwidth=10)))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"3f52410cba15f9bf9af3794885875e84852cf11a","_cell_guid":"3192cb26-e8ba-4e6e-ab99-9d3368cce276"},"cell_type":"markdown","source":"- Fare is predictive of Surival. Surviors paid higher fares.\n- Fare does not vary by Passenger Class as much as I would expect. It turns out several passengers can be on the same Ticket. The Ticket Fare depends on  the number of passengers on the ticket. I will add variables to count number of passengers traveling together on a ticket and fare per person.\n- Surviros were more likely to have higher number of Parents/Children on board. Is this because children who survived had parents? Or were parents also more likely to survive? I will try to disambiguate the Parch variable to identify what passengers were likely to be parents.\n- There is no clear relationship between Sibsp (siblings and spouses) and surival.\n- Embarkment and missing values for Age don't appear to predict survival.\n- The distribution of family-size (Parch and SibSp) differs by Passenger Class.\n- Embarkment differs by class.\n- Most people with missing age were in thrid class."},{"metadata":{"_uuid":"955431879701458ded0e06ad1a63d638bce45257","_cell_guid":"bb67efde-26c6-4dac-afdd-146eafd54603"},"cell_type":"markdown","source":"## Sex, Class and Survival\n\nNow lets take a closer look at some of the predictors. In the pair plots we saw the biggest effects of Sex and Class. The following plots examine these variables and their interaction."},{"metadata":{"_uuid":"4b281be45acd3ccc2609eb1af02587932ebafc90","trusted":false,"_cell_guid":"f0c561cb-e859-46f4-a1d6-38f0a7dfb8c3"},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=3) # Change plot size\ntrain %>% ggplot(aes(x=Sex, fill=Survived)) + \n        geom_bar(stat=\"count\")","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"86c25ce18a2a9370a2e06e9a51ea0577be5be93c","trusted":false,"_cell_guid":"a78b4744-c2c0-4b94-b645-59852be6e734"},"cell_type":"code","source":"train %>% ggplot(aes(x=Pclass, fill=Survived)) + \n        geom_bar(stat=\"count\") +\n        facet_grid(~Sex)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d203c23cae76286d501d8b6df84ea0f1e94113f1","_cell_guid":"e0e7a6d3-51ce-4731-ba52-5272f34dea24"},"cell_type":"markdown","source":"#### Passenger Class among Females\n- Among women, those in the first or second class were virtually assured survival.\n- Among third-class women, survival was 50/50.\n- What factors among third-class women helped lead to survival?\n\n#### Passenger Class among Males\n- Among men, those in 1st class were most likely to survive.\n- There were very few male survivors in 2nd class.\n- Third-class men, who were the most numerous on the boat, had the worst survival rates.\n- We should see what factors among men helped lead to survival?"},{"metadata":{"_uuid":"f91ef0b0491aa4e2dac37364010a7f17e9db4fba","_cell_guid":"e365d0e7-5fef-481c-bca2-b668271649e2"},"cell_type":"markdown","source":"## Interaction of Class, Sex and Age on Survival"},{"metadata":{"_uuid":"c0a17dbb4bf9dccde7aabc74d3f5fdef35baf794","trusted":false,"_cell_guid":"1e77db24-1d13-4c75-986e-d31f8d61500a"},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=5) # Change plot size\ntrain %>% \n        ggplot(aes(x=Age, y=as.numeric(Survived)-1)) +\n        geom_jitter(height=.1, width=0, alpha=.5) + \n        geom_smooth(method='loess', span=1) +\n        facet_grid('Pclass~Sex') + \n        scale_y_continuous(breaks=c(0,1),labels = c('N','Y')) +\n        ylab('Survied')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1f785f34591fdeb992aa6ab554abb7dd490141dd","_cell_guid":"b0cd51e9-0efd-49c7-8b8a-e9705829c000"},"cell_type":"markdown","source":"##### Age among Females\n- First and second class women are likely to survive regardless of age.\n- Among third-class women, age matters. Younger women are more likely to survive. There appears to be a dip in surival rates starting at about age 30. The one elderly third-class woman on board did survive, but it is hard to make much on one data point.\n\n##### Age among Males\n- Among men, being very young predicts suvival. First and second class boys under the age of 18 were assured survival.\n- Third class boys were more likely to survive than the third-class men, but still had less than 50% chance of survival."},{"metadata":{"_uuid":"e5b031fad7e5fd4f72d452ddad54081290aedbe0","_cell_guid":"d324ab6e-ff74-4730-acda-720977b4b531"},"cell_type":"markdown","source":"## Groups & Families\n\nWe have seen that children are more likely to survive. This is most notable among 2nd class males, the boys surivived and then men mostly did not. We also see indications of children being the highest priority to save amongst the other groups. \n\nWhat about the Parents of these children? Are parents more likely to survive?\n\nIn this section I extract information about the groups the individual passengers are traveling in to answer this and other questions.\n\n### group_by ticket \n\nFirst lets look at groups traveling on the same ticket. Below I extract the count of individuals on the same ticket (ticket_count), and stats about the ages of those passengers. I bind this information to the passenger-data using a table join. The ages of people in the group will be useful in determining what passengers are parents. "},{"metadata":{"_uuid":"dcfe53bd7e273fc087290ec6b035db9ddb9dfb71","trusted":false,"_cell_guid":"ac2870a8-8f6a-49f0-ba24-2e834b1613c5"},"cell_type":"code","source":"groupinfo = titanic %>% group_by(Ticket) %>% \n        summarise(ticket_count=n(),\n                 min_age = min(Age),\n                 max_age = max(Age),\n                 med_age = median(Age))\n\nngroups = groupinfo %>% filter(ticket_count > 1) %>% nrow()\ngroupinfo$groupid = NA\ngroupinfo[groupinfo$ticket_count > 1, 'groupid'] = 1:ngroups\n\nngroups %>% paste('groups with more than 1 passenger traveling on the same ticket')","execution_count":null,"outputs":[]},{"metadata":{"collapsed":true,"_uuid":"aea6f53ec3021b09bdfebc660acf5a1b95473383","trusted":false,"_cell_guid":"1a648266-6050-4fa2-8053-78a7569b9302"},"cell_type":"code","source":"titanic = titanic %>% left_join(groupinfo, by='Ticket')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a6f67cc17fb7101eed3e5ac3cffb8f75868b0e57","_cell_guid":"fbfc0ef9-c98b-4f9b-86ba-31a8ef9b9789"},"cell_type":"markdown","source":"### group_by surname\n\nSome passengers have seperate tickets for everyone in the group, we can group them using their surnames. Then extract group-level information and join it back to the original data set."},{"metadata":{"_uuid":"c67d7c7017e4e758b615558f578eff40a8e125d2","trusted":false,"_cell_guid":"8a2eb531-b1f9-4e02-9c6a-c2fea5f88bd7"},"cell_type":"code","source":"surnamegroup = titanic %>% group_by(surname) %>% \n        summarise(surname_count=n(),\n                min_age = min(Age),\n                 max_age = max(Age),\n                 med_age = median(Age),\n                 Parch=max(Parch),\n                 SibSp=max(SibSp)) %>% \n        filter(surname_count > 1, (Parch>0 | SibSp>0)) %>% \n        select(-Parch, -SibSp)\n\nnsurgroups = surnamegroup  %>% nrow()\nnsurgroups %>% paste('groups with same surname')\nsurnamegroup$surgroup = 1001:(1000+nsurgroups)\n","execution_count":null,"outputs":[]},{"metadata":{"collapsed":true,"_uuid":"fdf34b47ea8b284c6f56e5833eece6ce1166ed3a","trusted":false,"_cell_guid":"3bcbaf6e-d4be-42da-9644-d4dd7260bc4d"},"cell_type":"code","source":"titanic = titanic %>% left_join(surnamegroup, by='surname', suffix = c('.ticket','.surname'))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e417313dc2697aa03b005b08e485e3c282a32ebc","_cell_guid":"4163528a-36df-494f-a5e5-9353af976b07"},"cell_type":"markdown","source":"### Combine Groups\nI have identified groups based on shared tickets and shared surnames. In the case of shared surnames the passengers had to also identify that they were traveling with family under Parch or Sibsp to be grouped. Lets look at how many people are identified as traveling in a group in the two different ways."},{"metadata":{"_uuid":"613ff98232907ab64c8003e81ba107afe17d5a4d","trusted":false,"_cell_guid":"38d087d6-aba8-407c-b30c-651113ee57a3"},"cell_type":"code","source":"titanic %>% filter(!is.na(groupid)) %>% nrow() %>% paste('passengers with shared tickets')\ntitanic %>% filter(!is.na(surgroup)) %>% nrow() %>% paste('passengers with family of same surname')\ntitanic %>% filter(is.na(groupid), is.na(surgroup)) %>% nrow() %>% paste('passengers traveling alone')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0e8b75964136f48946876ae8be5abd2f10f7358a","_cell_guid":"c3c8c769-c4b4-44dc-8722-4200e17070ea"},"cell_type":"markdown","source":"Now lets combine the two groupings into one. I give prescedence to groups traveling on the same ticket.\nIf passengers are not identified in a group based on ticket then I look for surname groups."},{"metadata":{"_uuid":"96e28b3301be733e4467809690bf8c2a83ffc7d8","trusted":false,"_cell_guid":"a313b544-8ae1-42b7-9f35-eeb1deaa0ba7"},"cell_type":"code","source":"# Combine 2 kinds of groups\ntitanic[is.na(titanic$groupid),'groupid']=titanic[is.na(titanic$groupid),'surgroup']\ntitanic %>% filter(!is.na(groupid)) %>% nrow() %>% paste('passengers in groups (on same ticket or identified family)')\ntitanic %>% filter(is.na(groupid)) %>% nrow() %>% paste('passengers traveling alone')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"76711ae74ba0b8d84471dacccfb571e2bf0d9698","_cell_guid":"097156f3-8cb0-4e3a-862b-dce7641a59f5"},"cell_type":"markdown","source":"### More Family Features\n\nCreate a few more features about Families."},{"metadata":{"collapsed":true,"_uuid":"e00f2ae29b1504e0c57419ea7e97fe518ff6041d","trusted":false,"_cell_guid":"28629b7c-26f9-45f7-b9fc-deb5c48fbf50"},"cell_type":"code","source":"titanic$family_count = titanic$Parch + titanic$SibSp + 1\ntitanic$with_family = !is.na(titanic$groupid)\ntitanic$Fareperperson = titanic$Fare / titanic$ticket_count\ntitanic$min_age.surname[is.na(titanic$min_age.surname)]=titanic$Age[is.na(titanic$min_age.surname)]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7ce168753877d076d5c92f5d9f406c44f5c39224","_cell_guid":"86cfea56-5e68-41ab-a3a6-b4b3612f333c"},"cell_type":"markdown","source":"### Identify Parents"},{"metadata":{"_uuid":"e162652f3088bee3193b136b383cd60d8ad7c90b","_cell_guid":"ed4b8b5a-246c-4f34-b0db-3e70af4fa7e5"},"cell_type":"markdown","source":"Now I try to identify who the Parents are on board. I've already seen that Children are likely to survive. Are the Parents of those children also likely to survive?"},{"metadata":{"_uuid":"946fcf523d7d95c3f2fe9ec53e22dbdeeef4498c","trusted":false,"_cell_guid":"8a2f05d2-fa71-4c28-9d82-753a118dd045"},"cell_type":"code","source":"titanic %>% filter(Parch>0) %>% nrow() %>% paste(': number of passengers identifying a parent or child on board')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0a9067156f4e41e83f39d797901ed909db223cef","trusted":false,"_cell_guid":"0191a594-e4af-46ae-8935-9acbd930da44"},"cell_type":"code","source":"titanic$is.parent = 0\n\n# This block of code implements the logic for identifying parents. \nG = 18 # Minimum age to be identified as a parent\nC = 14 # Cut-off\nD = 14 # Minimum difference between \ntitanic[\n    # Identified atleast 1 child on board\n    titanic$Parch>0 &\n    # Age is greater than or equal to G\n    titanic$Age>=G & \n        #There is someone on the ticket or with your same surname under age C (helps rule out the adult children)\n        (titanic$min_age.ticket < C | titanic$min_age.surname < C) &\n    \n        #The child on the ticket is atleast D years younger than the individual being identified as a parent\n        (titanic$Age - titanic$min_age.ticket >= D | titanic$Age - titanic$min_age.surname >= D),\n    \n        ]$is.parent = 1\n\ntitanic$is.parent = factor(titanic$is.parent,labels=c('Not Parent','Parent'))\ntitanic %>% filter(Age < C) %>% nrow() %>% paste('children under', C, 'years')\ntitanic %>% filter(is.parent == 'Parent') %>% nrow() %>% paste('identified parents')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"f8aa705acca8d0df16d2050c65e22f77c6077081","_cell_guid":"4de0ceb0-3a6c-4a18-892e-07b7d8977e33"},"cell_type":"markdown","source":"Now take a closer look at the distribution of Passenger Age and min_age (age of youngest passenger traveling in same group)."},{"metadata":{"_uuid":"0387ee17f29ebb42b8a809869074787c59d12114","trusted":false,"_cell_guid":"003c234a-8c5e-4436-b52f-c7cd696737b3"},"cell_type":"code","source":"options(repr.plot.width=8, repr.plot.height=3) # Change plot size\n\ntitanic %>% filter(Parch>0) %>% \n    ggplot(aes(x=Age, fill=Pclass)) + geom_histogram(bins=20, position = 'stack',color='white') + facet_wrap(~is.parent)\n\ntitanic %>% filter(Parch>0) %>% \n    ggplot(aes(x=min_age.ticket, fill=Pclass)) + geom_histogram(bins=20, position = 'stack',color='white') + facet_wrap(~is.parent)\n\ntitanic %>% filter(Parch>0) %>% \n    ggplot(aes(x=min_age.surname, fill=Pclass)) + geom_histogram(bins=20, position = 'stack',color='white') + facet_wrap(~is.parent)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"54b48bc004a6eb8fcf64127cb67ef52f486d98b3","_cell_guid":"7ff99423-6b9e-4ea9-9a6f-9443bedc7b87"},"cell_type":"markdown","source":"# Explore Effects of Family"},{"metadata":{"collapsed":true,"_uuid":"8ef1e9bf1c2cf1a5bc25f11eca67f185b834f545","trusted":false,"_cell_guid":"11bf6c5c-5c7a-4045-8bec-c629fe3af5ef"},"cell_type":"code","source":"# Lets dig into the training data. Set cross-validation data asside\ntrain = titanic %>% filter(Partition=='train')\ncross = titanic %>% filter(Partition=='cross')\ntest = titanic %>% filter(Partition=='test')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0ee2ef24f86583fe1ac743dd37bc6cae801701bd","_cell_guid":"9dd0e311-2511-43c3-81c8-19c9eee7ba15"},"cell_type":"markdown","source":"### Effect of Being a Parent\n\nI'm dying to know. Are the parents of young children likely to survive?"},{"metadata":{"_uuid":"ba23ad95ff326cabd1109664d1b6813d661b4f78","trusted":false,"_cell_guid":"85ecbb01-d209-45a5-92ed-d360144e6b77"},"cell_type":"code","source":"options(repr.plot.width=4, repr.plot.height=2) # Change plot size\n\ntrain %>% ggplot(aes(x=is.parent, fill=Survived)) + \n    geom_bar(stat='count') \ntrain %>% ggplot(aes(x=is.parent, fill=Survived)) + \n    geom_bar(position = 'fill') + labs(y='survival rate')\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"55afca8e02ced960fd2c2b8540c0873df1e7d977","_cell_guid":"a6a69ad0-2a3a-4bf8-b4fd-d46b924dd471"},"cell_type":"markdown","source":"The plots above show that among the passengers, the parents on board were no more likely to surive than other passengers."},{"metadata":{"_uuid":"25eb401753506899a0eb8b2950747e245798ca36","_cell_guid":"f760467a-e5df-4c61-a5f0-e7fd98a08e5e"},"cell_type":"markdown","source":"### Effect of being a Parent by Sex & Class"},{"metadata":{"_uuid":"8fa5ffba63de0aefd1df953558cf5d8cf326d20d","trusted":false,"_cell_guid":"00b53a96-34ea-4c20-9d70-7e6ff739b44c"},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=4) # Change plot size\n\ntrain %>% filter(Age>=18) %>% \n    ggplot(aes(x=as.numeric(is.parent), y=as.numeric(Survived)-1)) + \n    geom_jitter(width = .2,height=.2, alpha=.5) + \n    geom_smooth(method='lm') +\n    scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) +\n    labs(y='Survived') +\n    facet_grid(Pclass~Sex) ","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"cf6745226475d532b0330fde628fcc9b3f0dcd6a","_cell_guid":"e27cfc4e-1b46-4aa2-8971-0d3435c8fe35"},"cell_type":"markdown","source":"These plots show the effect of being a parent for each Sex and Passenger Class. \n\n-Among the first and second class there is a very small number of parents of small children, so it is hard to make generalizations about the effect of being a parent among this group. (There are actually more 1st class parents in the test set than their are in the training set!)\n\n-Among the third class there is a fair number of parents on board, but there is no indication of Parents being more likely to survive. There is a trend of Parents actually being less likely to survive."},{"metadata":{"_uuid":"5a5fd6534032c63bb93256269cb05e0a956dac92","_cell_guid":"dce013fc-ab9e-494a-8682-aa69b0141b33"},"cell_type":"markdown","source":"### Parch: Effect of Number of Parents or Children\n\nWe saw an effect of the Parch variable in the Pairplots. Lets take a closer look at what could be driving this effect. "},{"metadata":{"_uuid":"957cab89a133b5fd77f6478f5e8d2c0ba885a8fe","trusted":false,"_cell_guid":"d19f7e36-a0e7-4929-b8d0-52a3858ad2f0"},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=3) # Change plot size\n\n## Parch Variable\ntrain %>% ggplot(aes(x=Parch, y=as.numeric(Survived)-1))+\n    geom_jitter(height=.3, width=0, alpha =.5)+ \n    scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) +\n    labs(y='Survived') +\n    geom_smooth(span=1, method='loess')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5b9155d364efed4064cc1f256257fc53b078cd09","_cell_guid":"ab067fda-ceef-4eef-90e1-75225f5ab3c8"},"cell_type":"markdown","source":"We see that there is a peak survival with Parch equal to about 2. That could be a confound of Age. Children are likely to have a score of 1 or 2 on Parch and are the most likely to survive. Can we break this down?"},{"metadata":{"_uuid":"ba5fb2c609ac7979ab2e72f6c04e1665e391e97a","trusted":false,"_cell_guid":"30924c8a-b8e7-485f-9e9c-678072855993"},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=4) # Change plot size\n\n## Parch by Parental Status\noptions(warn=-1)\ntrain %>% ggplot(aes(x=Parch, y=as.numeric(Survived)-1))+\n    geom_jitter(height=.2, width=0, alpha =.3)+ \n    geom_smooth(method='loess', span=1) + \n    facet_grid(Age>14~is.parent)+\n    scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) +\n    labs(y='Survived', title = \"Parch and Survival\", subtitle = 'Among Children (top left), Parents (bottom right) and Others (bottom left)')\n#+\n#train %>% filter(is.parent==0 & Parch>2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0d1b6640c62b752a86972f3ec79b935d3d405f74","_cell_guid":"2840aab1-fb12-40af-b821-8ea546f41ca1"},"cell_type":"markdown","source":"This plot shows the relationship of Parch when faceted by Parental Status and Age.\n\n- On the top left we have the Children under age 14. For them, we see a downward trend with having 2 Parents on board being worse than only 1 Parent on board (possibly a confound of Class). Only a few children were traveling without their parents, but they actually had the best survival rates (maybe they were 1st class?)\n\n- On the bottom right are the Parents of Children under 14. It appears that having smaller numbers of children was better for survival among parents (again, possibly a confound of Class)\n\n- On the bottom left are passengers who were above age 14 but were not identified as parents. Among this large group we see the pattern of having Parch of 2 predicts survival. This is a large heterogeneous group."},{"metadata":{"_uuid":"45062210edf32be454d5c44068c113c8045cb3d3","trusted":false,"_cell_guid":"e661cce5-9dfa-4ed7-9f90-c7777ebaa88b"},"cell_type":"code","source":"titanic %>% filter(Age<18, Parch<3) %>% ggplot(aes(x=Parch, y=as.numeric(Survived)-1))+\n    geom_jitter(height=.3, width=0, alpha =.5)+ \n        geom_smooth(span=1, method='loess') + facet_grid(Pclass~Sex)+\n        labs(title='Parch on Survival Rates Among Children, Under age 18') +\n        scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) +\n        labs(y='Survived')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"155723aa3999361762e20d4278407f64e5675e17","_cell_guid":"6546013c-1fde-4aad-8d65-3b0611811415"},"cell_type":"markdown","source":"- Among the Female Children having higher Parch score is bad for Survival. Female Children traveling with no Parents actually did the best.\n\n- In contrast, the male children in 1st and 2nd class traveling without parents did not survive. Those with 1 or 2 parents had high survival rates.\n- In the third class where more children were traveling, there was no clear effect of traveling with more Parents among male children."},{"metadata":{"_uuid":"85658df9b0bd7e0d48bfd225387ea0f60c62e3a7","trusted":false,"_cell_guid":"f0c82b2a-a650-4b4b-a206-f271173b2da3"},"cell_type":"code","source":"titanic %>% filter(is.parent=='Parent')%>% ggplot(aes(x=Parch, y=as.numeric(Survived)-1))+\n        geom_jitter(height=.3, width=0, alpha =.5) + \n        geom_smooth(span=1, method='loess') + facet_grid(Pclass~Sex)+\n        labs(title='Parch on Survival Rates Among Parents') + \n        scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) +\n        labs(y='Survived')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"c6a3d0a86275beb0b3f49430517d725f6fb83ed8","_cell_guid":"10940db9-0ba7-48c6-8120-d6d143120e05"},"cell_type":"markdown","source":"- This above plot shows the effect of number of children among Parents for each Sex and Passenger Class. Group.\n- We have few Parents among the 1st and 2nd class so it is hard to conclude anything about them.\n- Among the thrid class Moms and Dads we see a more children being bad for survival."},{"metadata":{"_uuid":"33b0de46060760b2ff9c7ecec9d92edf0d69a87c","trusted":false,"_cell_guid":"3e3e52f4-ded2-4945-a0de-1868ad4180d1"},"cell_type":"code","source":"titanic %>% filter(is.parent=='Not Parent' & Age>=G) %>% \n        ggplot(aes(x=Parch, y=as.numeric(Survived)-1))+\n        geom_jitter(height=.3, width=0, alpha =.5)+ \n        geom_smooth(span=1, method='loess') +\n        labs(title='Parch on Survival Rates Among Adult Non-Parents') + \n        scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) +\n        labs(y='Survived')\n\ntitanic %>% filter(is.parent=='Not Parent', Age>=G) %>% \n        ggplot(aes(x=Parch, y=as.numeric(Survived)-1))+\n        geom_jitter(height=.3, width=0, alpha =.5)+ \n        geom_smooth(span=1, method='lm') + facet_grid(Pclass~Sex)+\n        labs(title='Parch on Survival Rates Among Adult Non-Parents', subtitle='By Sex and Class') + \n        scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) +\n        labs(y='Survived')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"4ac7a19a52cc5729a49a357f1ec6049a7e97579f","_cell_guid":"2764ed87-2b48-4d70-a6d2-51dc0a13fab0"},"cell_type":"markdown","source":"This plot shows the effect of the Parch variable on Adults who were not identified as Parents. \nIn all of the Sex-Class facets, we see that having a higher number for Parch is bad for Survival. \nThese data include Parents of Older Children and the Adults who were traveling with their own Parents.\n\n#### Summary of Parch Variable\n- When we look at the raw effect of the Parch variable we see a peak survival at Parch = 2. This does appear to be an artifact of Children being like to have Parch of 2.\n- Among Children under age 18, having Parents seemed to help Male children but hinder Female children.\n- Among Parents and Non-Parents at or above age 18 having a higher number on Parch is bad for Survival. Adults traveling with more Parents/Children have worse survival rates."},{"metadata":{"_uuid":"c0581a56a93197fffa0624adfdbafa5672ea3908","_cell_guid":"1868eaae-80c3-46df-a81a-9b3bfbc316ad"},"cell_type":"markdown","source":"### Effect of Age of Children Among Parents"},{"metadata":{"_uuid":"6d587d7180b677aaf58b6f08427b7c10f453dca4","trusted":false,"_cell_guid":"d270cb91-616b-4c6e-91c0-545dc20a5187"},"cell_type":"code","source":"train %>% filter(is.parent=='Parent') %>% \n    ggplot(aes(x=min_age.surname, y=as.numeric(Survived)-1)) +\n    geom_jitter(height=.1, width=0, alpha=.5)+\n    geom_smooth(span=1, method='loess') + \n    scale_x_continuous(limits=c(0,18), breaks = 0:18) + \n    scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) +\n    labs(y='Survived', title='Among Parents, youngest child and survival')\n\ntrain %>% filter(is.parent=='Parent') %>% \n    ggplot(aes(x=min_age.surname, y=as.numeric(Survived)-1)) +\n    geom_jitter(height=.1, width=0, alpha=.5)+\n    geom_smooth(span=1, method='loess') + \n    scale_x_continuous(limits=c(0,18), breaks = 0:18) + \n    facet_wrap(~Sex) + \n    labs(title='Among Parents, youngest child and survival - by Sex', y='Survived')+ \n    scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) ","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"6812b6e0972f56feb8fa83f6041ecbb703200691","_cell_guid":"11e35ccd-6986-49e4-aeeb-f4df1c54678a"},"cell_type":"markdown","source":"No, parents of very young children are actually Less likely to survive than parents of older children! Parents with children around age 4 had the lowest survival rates. Those with older children actually had better survival rates. We can try to facet this by Class."},{"metadata":{"_uuid":"82fe7f7c82c48aff325c4b46a406d02dd9a92627","trusted":false,"_cell_guid":"95b926ae-c055-4d75-b2b9-0ff9d606d0bc"},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=5)\ntrain %>% filter(is.parent=='Parent') %>% \n    ggplot(aes(x=min_age.surname, y=as.numeric(Survived)-1)) +\n    geom_jitter(height=.1, width=0, alpha=.5)+\n    geom_smooth(span=1, method='loess') + \n    scale_x_continuous(limits=c(0,18), breaks = 0:18)+ \n    facet_grid(Pclass~Sex) + \n    labs(title='Among Parents, youngest child and survival - by Sex and Class', y='Survived')+ \n    scale_y_continuous(breaks=c(0,1),labels = c('N','Y'), limits = c(-0.5,1.5)) \n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"0ffae333e0d5d8788c3f19f9ba81405f232518b8","_cell_guid":"48013dd0-aae8-4152-ac5f-feed581e49a3"},"cell_type":"markdown","source":"Again, we have few Parents among the 1st and 2nd class, so we can't make much of their data.\n\n- Among third class Moms, those with older children have better survival rates. Those with their youngest child being around age 4 had the worst survival rates. (Could be related to Family-Size?)\n- Among third class Dads we only see one survivor, the Father of a 1 year old. It is hard to say whether him being a parent was a factor in his survival, but we know that his daughter did survive. We don't know the fate of his wife whom is in the test set (see below)"},{"metadata":{"_uuid":"2225ad813e6cb32ab3b9a4bd54885304cd590dd8","trusted":false,"_cell_guid":"4df4f8d9-baa9-4a22-b794-787dd348e6f8"},"cell_type":"code","source":"train %>% filter(Sex=='male',Pclass==3,is.parent==1,Survived==1)\ntitanic %>% filter(Ticket==2653) %>% select(Partition,Name,Sex,Age,Pclass,Survived)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"17593191c91422484543de6c5593328b783c3066","_cell_guid":"c131ae96-2353-4069-9723-42ba26533ff9"},"cell_type":"markdown","source":"### Look for Survivors in Group \n\nThis suggests a good way to predict Survival for those traveling in groups. We should look to see if anyone else or if the majority of people in a given group have survived. In the code below I compute whether anyone ELSE in each group is a known survivor. I compute this by counting the number of known survivors in each group. If the individual was a Survivor themselves then there must be atleast 2 survivors among the total group. If the individual is not a Survivor then there must be atleast 1 survivor among the group. "},{"metadata":{"collapsed":true,"_uuid":"bf841313b04bec2fb4ba723dc949ba5648d135ba","trusted":false,"_cell_guid":"5c87eb89-5eef-4232-9fd4-1f3ccdb80872"},"cell_type":"code","source":"# Is anyone else in your group a known survivor?\ntitanic = titanic %>% group_by(groupid) %>% \n    mutate(nsurvivors = sum(as.numeric(Survived)-1),\n            groupSurvivor = ifelse(Survived==1, nsurvivors>1, nsurvivors>0)) %>% \n    select(-nsurvivors) %>% ungroup()\n\ntitanic[is.na(titanic$groupid),'groupSurvivor']=FALSE\n\ntrain = titanic %>% filter(Partition=='train')\ncross = titanic %>% filter(Partition=='cross')\ntest = titanic %>% filter(Partition=='test')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"86b30916c2ade039d58f4cb2e59e7f30736bcf4b","_cell_guid":"7a1942c7-bf0d-4ca6-a256-94fb731d294c"},"cell_type":"markdown","source":"Does traveling with another Survivor predict Surviving yourself?"},{"metadata":{"_uuid":"ac555a5c7d94374bbcfca1088f536a3a679dc75f","trusted":false,"_cell_guid":"259e6598-c4c0-4512-a82d-47cecb8f0b59"},"cell_type":"code","source":"train %>% select(Survived, groupSurvivor) %>% summary()","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"f11f50d5113e94785a7f6a64deecd097e0ad9b3d","trusted":false,"_cell_guid":"e452302e-09c8-4389-a77c-24cf81f2448e"},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=3)\ntrain %>% \n    ggplot(aes(x=groupSurvivor, fill=Survived)) + \n    geom_bar(stat='count')  + \n    facet_grid(~with_family) +\n    labs(title='Does Traveling with another Survivor Predict You Surviving?',\n         subtitle='facet by traveling with Group')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"dff7707be40216ebe7f49f13e2430db14d038b0d","_cell_guid":"c7b8580b-6139-4320-a6af-44183f910d4a"},"cell_type":"markdown","source":"On the left are individuals traveling by themselves. By definition, no one ELSE in their group survived.\n\nOn the right are individuals traveling in groups. Those who were traveling with someone el who survived were more likely to survive themselves. This seems like a very useful feature.  Does it do a good job predicting survival among all the Sex and Class groups?"},{"metadata":{"_uuid":"d93840808a64566c9a137215309c28ad524ef2d0","trusted":false,"_cell_guid":"a5f7ed4c-6215-495a-8da4-c8ab0f41c1f0"},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=6)\ntrain %>% filter(with_family) %>% \n    ggplot(aes(x=groupSurvivor, fill=Survived)) + \n    geom_bar(stat='count') + \n    facet_grid(Pclass~Sex) +\n    labs(title='Traveling with another Survivor Predicts Surviving.',\n         subtitle='facet by Sex and Class')\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"fbc65d26c1a412f1e3f4d8d245b6fb46776382bf","_cell_guid":"38e387b0-a937-4635-b2e2-cd1d77b35cf7"},"cell_type":"markdown","source":"Traveling with someone else who survives appears to help across the board. This plot includes only people traveling in groups. This feature wont help the half of passengers traveling alone, but does give a lot of predictive power to those traveling in groups. We have about the same number of people traveling alone as those traveling in groups."},{"metadata":{"_uuid":"adbdd3a6c8fbce7a491f190e818d27dfdae769f4","_cell_guid":"60ea25ed-c588-4561-8a7f-f774940c6081"},"cell_type":"markdown","source":"### Fit Models and Make Predictions.\n\nI have explored this data set pretty thuroughly, atleast regarding the variables Sex, Passenger Class, Age, and Family. I think I have a descent understanding of what is going on in this dataset. \nTime to try modeling. "},{"metadata":{"collapsed":true,"_uuid":"629a765287907e08e88dc64c14760fb09766a490","trusted":false,"_cell_guid":"b663d392-9617-45fd-b06a-a889a833c0ca"},"cell_type":"code","source":"titanic = titanic %>% mutate(child=Age<18,\n                             old=Age>=35,\n                             group_count=ifelse(ticket_count > family_count,\n                                          ticket_count, family_count))\ntitanic[is.na(titanic$Fare),'Fareperperson']=0\ntitanic[is.na(titanic$Fare),'Fare']=0\n\ntrain = titanic %>% filter(Partition=='train')\ncross = titanic %>% filter(Partition=='cross')\ntest = titanic %>% filter(Partition=='test')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d708c50280f122b0f94845be06ef3c638acaf25d","trusted":false,"_cell_guid":"02536ba5-2ce9-4ded-b153-b9a031e9b4af"},"cell_type":"code","source":"set.seed(420)\nforest = randomForest(Survived~Pclass + Sex + child + old + family_count + min_age.ticket +\n                      Fareperperson + HasCabin + title + groupSurvivor + with_family, \n                      data=train)\nforest","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1435f494b635a397a4629efd75302715955d632e","trusted":false,"_cell_guid":"f330b5fb-808e-449c-8af1-3ff50b2e8558"},"cell_type":"code","source":"cross$rfpredict = predict(forest,cross)\ncross$rfcorrect = cross$rfpredict==cross$Survived\n\ntable(cross$Survived, cross$rfpredict)\nmean(cross$rfcorrect)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"647b02eaf33c68d9af552816d38bf47bb4c94398","trusted":false,"_cell_guid":"b8a0efa6-df38-47fa-bb91-76468861a942"},"cell_type":"code","source":"myprediction=data.frame(PassengerId=test$PassengerId)\nmyprediction$Survived = as.numeric(as.character(predict(forest, newdata =test)))\nwrite.csv(myprediction, file='my_solution.csv', row.names = FALSE)\nmyprediction$Survived %>% table()\n# submitted 77.511% Correct on Test","execution_count":null,"outputs":[]},{"metadata":{"collapsed":true,"_uuid":"09c6616dd31fd7d8662330b90e89bc165e0c19a1","trusted":false,"_cell_guid":"386eddad-6b3d-4d72-8288-4e3e0a48885e"},"cell_type":"code","source":"test_model  = function(model) {\n    myprediction=data.frame(PassengerId=test$PassengerId)\n    myprediction$Survived = as.numeric(as.character(predict(model, newdata =test)))\n    write.csv(myprediction, file='my_solution.csv', row.names = FALSE)\n    list(model,myprediction)\n    }\n\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5a4c682dfcf5f511d610a753661135a6057bb18d","trusted":false,"_cell_guid":"ed3803f1-c7aa-4ede-b3ae-2046a9ac2da2"},"cell_type":"code","source":"forest = randomForest(Survived~Pclass + Sex + child + old + family_count + min_age.ticket +\n                      Fareperperson + HasCabin + title + groupSurvivor + with_family, \n                      data=train)\nresults = test_model(forest)\nresults$test_accuracy = .77511\nresults[[1]]\nresults[3]\nimportance(forest)\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2edd8250dc8ca303fc98f9d4742e19c61a092c69","trusted":false,"_cell_guid":"660b8295-3df8-4b53-aecd-7971b0987168"},"cell_type":"code","source":"# removed min_age.ticket\nforest = randomForest(Survived~Pclass + Sex + child + old + family_count + \n                      Fareperperson + HasCabin + title + groupSurvivor + with_family, \n                      data=train)\nresults = test_model(forest)\nresults[1]\npaste('scored','0.80382')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"bab41c1b28cf743d779b6367c136bdad1e9ae82e","trusted":false,"_cell_guid":"b47b061c-2cac-4fb4-8330-915fdbbb8b4e"},"cell_type":"code","source":"# Swapped child and old with Age\nforest = randomForest(Survived~Pclass + Sex + Age + family_count + \n                      Fareperperson + HasCabin + title + groupSurvivor + with_family, \n                      data=train)\nresults = test_model(forest)\nresults[1]\npaste('scored',('0.76076'))\nimportance(forest)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"cbebf388b6926929b716a026fb9ffdb523c2247f","trusted":false,"_cell_guid":"4292a78f-f21f-4b1a-8459-25c0d7df9c12"},"cell_type":"code","source":"bestsofar = randomForest(Survived~Pclass + Sex + child + old + family_count +\n                      Fareperperson + HasCabin + title + groupSurvivor + with_family, \n                      data=train)\nresults = test_model(bestsofar)\nresults[1]\nimportance(bestsofar)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"290b627f8dcf767a5a97356a25a1e0ad4f8615cc","trusted":false,"_cell_guid":"e4d0d706-b8e9-426b-9ed9-9ec0c9499d85"},"cell_type":"code","source":"# removed child, old, and Age. Now no indication of Age except maybe Title and this does even better.\nevenbetter = randomForest(Survived~Pclass + Sex + family_count +\n                      Fareperperson + HasCabin + title + groupSurvivor + with_family, \n                      data=train)\nresults = test_model(evenbetter)\nresults[1]\nimportance(evenbetter)\npaste('scored',('0.81339'))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2172a36ec3d1da0f987f04a540a4e0790072c7f8","trusted":false,"_cell_guid":"72abd839-d2c4-491a-bab0-2ab85e33c8da"},"cell_type":"code","source":"# removed with_family\ntry = randomForest(Survived~Pclass + Sex + family_count +\n                      Fareperperson + HasCabin + title + groupSurvivor, \n                      data=train)\nresults = test_model(try)\nresults[1]\nimportance(try)\npaste('scored','.79904')\n\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"f4106478402deddc0568a2d116ddbeed6cebe7ee","trusted":false,"_cell_guid":"9f8c6b87-b957-4006-a987-cdca4f736c17"},"cell_type":"code","source":"# switched family_count to ticket_count\ntry = randomForest(Survived~Pclass + Sex + ticket_count + with_family +\n                      Fareperperson + HasCabin + title + groupSurvivor, \n                      data=train)\nresults = test_model(try)\ntry\nimportance(try)\npaste('scored','.80861')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d158628ee80e73ff32a9d61933a5137dc3feed18","trusted":false,"_cell_guid":"e17bdefa-f2c5-43ef-a967-3b252aa80b32"},"cell_type":"code","source":"# switched family_count to group_count\nbestyet = randomForest(Survived~Pclass + Sex + group_count + with_family +\n                      Fareperperson + HasCabin + title + groupSurvivor, \n                      data=train)\nresults = test_model(bestyet)\nbestyet\nimportance(bestyet)\npaste('scored','.81818')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"3cf9b57853d45c6221eb367a5d148cbe03966f47","trusted":false,"_cell_guid":"4b32dcc1-e974-455a-83a0-f012925ed610"},"cell_type":"code","source":"# Add Age back in\nwithage = randomForest(Survived~Pclass + Sex + group_count + with_family + Age +\n                      Fareperperson + HasCabin + title + groupSurvivor, \n                      data=train)\nresults = test_model(withage)\nbestyet\nimportance(withage)\npaste('scored','0.77990')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"aee5df24a703ef43e5bcae07a782cd8d57a98c7b","trusted":false,"_cell_guid":"56f2c862-d524-42a4-90a6-2bb1d66c4106"},"cell_type":"code","source":"# Keep Age, Lose Title\ntry = randomForest(Survived~Pclass + Sex + group_count + with_family + Age +\n                      Fareperperson + HasCabin + groupSurvivor, \n                      data=train)\nresults = test_model(try)\ntry\nimportance(try)\npaste('scored','not submitted')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"6de457e5b8ac38a4e5ec0df40469f15d57497224","trusted":false,"_cell_guid":"f43c6573-41b4-462b-ab89-bf1af6662941"},"cell_type":"code","source":"# Lose HasCabin\ntry = randomForest(Survived~Pclass + Sex + group_count + with_family + title +\n                      Fareperperson + groupSurvivor, \n                      data=train)\nresults = test_model(try)\ntry\nimportance(try)\npaste('scored','.81818')","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}