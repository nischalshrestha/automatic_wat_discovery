{"nbformat_minor": 0, "cells": [{"execution_count": null, "outputs": [], "source": "This is the basic EDL about training dataset. ", "cell_type": "markdown", "metadata": {"_uuid": "e14c0caa662629804336405c7db740ed6a167d71", "collapsed": false, "_cell_guid": "ed4d7dae-7c11-4a42-9f0b-628e3513cc19", "_execution_state": "idle"}}, {"execution_count": null, "outputs": [], "source": "## 1. Train Data Processing &Description\n\n###-Import and Overview\n\nlibrary(data.table)\ntrain <- read.csv(\"../input/train.csv\", sep=\",\", header=TRUE, stringsAsFactors=TRUE)\nsummary(train)", "metadata": {"_uuid": "20e4ce1113f7d06f221e2f163a1c741d63acb656", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "###-Deal with Age's NAs\ntrain = na.omit(train)\n#Age has 177 missing values. Cabin has 687 NAs and Embarked has 2. We'll can put Cabin and Embarked aside. \n#Age is an important demographic variable, so we can try to fill with predictions.\n\ntrain$Embarked=as.character(train$Embarked) #change data type that can add NA\n#train[Embarked=='', Embarked:=NA] #set '' in Embarked as missing value\n\n#Tried regression model, R-square is not ideal. So take the tree method.\nlibrary(rpart)\nlibrary(ggplot2)\nlibrary(gridExtra)\n#age_fit2 = rpart(Age ~ Pclass + Sex + SibSp + Parch\n#                +Fare+Embarked, \n#                data = train[!is.na(Age), ],\n#                na.action = na.omit, method = 'anova',cp=0.01)\n#page1=qplot(train$Age,geom='histogram',fill=I('turquoise3'),xlab='Age-raw', \n#           ylab='Numbers of People')\n#train[is.na(Age), Age := predict(age_fit2, newdata=train[is.na(Age)]) ]\npage2=qplot(train$Age,geom='histogram',fill=I('turquoise3'),xlab='Age-adjusted', \n            ylab='Numbers of People')\npage2\n\n#The two distribution of age seem alike. That's what we want.", "metadata": {"_uuid": "2d8aa27b7e083bc54d08c8e63a9fbf409e57728e", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "###-List single variable distribution except Name, Ticket and Cabin\n\n#Now, most of variables are factors and numbers. \n\npsur=qplot(train$Survived,geom='bar', ylab='Numbers of People',fill=I('turquoise3'), \n           xlab=\"0=Not survived   1=Survived\" )\nppclass=qplot(train$Pclass,geom='bar',fill=I('turquoise3'),xlab='Social-Economic Status', \n      ylab='Numbers of People')\npsex=qplot(train$Sex,geom='bar',fill=I('turquoise3'), xlab='Gender',\n      ylab='Numbers of People')\npss=qplot(train$SibSp,geom='bar',xlab='People with x Siblings and Spouse', \n      ylab='Numbers of People',fill=I('turquoise3'))\nppc=qplot(train$Parch,geom='bar',xlab='People with x Parents and Children', \n      ylab='Numbers of People',fill=I('turquoise3'))\npf=qplot(train$Fare, geom='histogram',fill=I('turquoise3'),xlab='Price of Ticket', \n      ylab='Numbers of People')\npe=qplot(train$Embarked, xlab='Embarked Port', fill=I('turquoise3'),\n      ylab='Numbers of People',geom='bar')\ngrid.arrange(psur, ppclass,psex,page2,pss,ppc,pf,pe, ncol=3)\n\n#Most people are in their golden ages(20~40). Most people are men. \n#Most people are travel alone. Most people from 3rd class. \n#Most people from Southampton. And most of them lost their lives in that adventure.", "metadata": {"_uuid": "23a8cc77de419a4ccff15028e82c3455a6f76ab2", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "###-Interesting Thing about Name: New Name &New Life\n\n##Name has many interesting title. Let's grasp these info.\ntrain$Title=gsub('(.*,)|(\\\\..*)','',train$Name)\ntrain$Title=as.factor(train$Title)\ntrain$Survived=as.character(train$Survived)\nggplot(train,aes(x=Title, fill=Survived))+geom_bar()+coord_flip()+scale_fill_brewer(palette = \"BuGn\")+ylab('')\n\n#The survived \"Miss\"\" is **no** more than married women \"Mrs\"\" in terms of ration. \n\n#Another phenomenon attracts me is that many people have two names, \n#like \"Cumings, Mrs. John Bradley (Florence Briggs Thayer)\". \n#Did they change name before this tragedy or after? We don't know. Just have a look.\n\ntrain$NewName=grepl('(', train$Name,fixed=TRUE)\ntrain$Survived=as.character(train$Survived)\nggplot(train,aes(x=NewName, fill=Survived))+geom_bar()+scale_fill_brewer(palette = \"BuGn\")+ylab('')\n\n#The ration looks high for people survived to have a second name. ", "metadata": {"_uuid": "126aa5ed66de65bbba2225a84099301d75199261", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "###-A Quick Look of Correlation and Importance: Women, Young, High Class\nlibrary(GGally) #Only shows numeric variables\ntrain <- as.data.table(train) \n\ntrain[Sex=='male',nSex:=1]\ntrain[Sex=='female',nSex:=2]\ntrain[Embarked=='C',Port:=1]\ntrain[Embarked=='Q',Port:=2]\ntrain[Embarked=='S',Port:=3]\ntrain$Survived=as.numeric(train$Survived)\nggcorr(train,label=TRUE, label_alpha=TRUE, name='Correlation', low = \"turquoise3\", mid = \"white\", high = \"orangered3\")\nlibrary(randomForest)\nrf = randomForest(Survived ~ Pclass+Age+nSex+Parch+SibSp+Fare+Port, data=train,\n                   na.action = na.omit, ntree=101, importance=TRUE)\nimp = importance(rf, type=1)\nfeatureImportance = data.frame(Feature=row.names(imp), Importance=imp[,1])\nggplot(featureImportance, aes(x=reorder(Feature, Importance), y=Importance)) +\n  geom_bar(stat=\"identity\", fill=I(\"turquoise3\")) +\n  coord_flip() +  xlab('')+ylab(\"Importance on Survive\")\n\n\n#Women, people of young age and people of higher class are more likely to survive.\n", "metadata": {"_uuid": "fc2e5979665521df67fbee6e7e24a00fc150294f", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "###-X with Survived\n\n#Take a close look of every independent variable influence on survive.\n#This time add SibSp and Parch as family size\n\ntrain$Survived=as.character(train$Survived)\nSurPc=ggplot(train,aes(x=Pclass, fill=Survived))+geom_bar()+ scale_fill_brewer(palette = \"BuGn\")+ylab('')\nSurage=ggplot(train,aes(x=Age, fill=Survived))+geom_histogram()+ scale_fill_brewer(palette = \"BuGn\")\nSurFam=ggplot(train,aes(x=SibSp+Parch, fill=Survived))+geom_histogram()+scale_fill_brewer(palette = \"BuGn\")+ylab('')\nSurFare=ggplot(train,aes(x=Fare, fill=Survived))+geom_histogram()+ scale_fill_brewer(palette = \"BuGn\")+ylab('')\nSurSex=ggplot(train,aes(x=Sex, fill=Survived))+geom_bar()+ scale_fill_brewer(palette = \"BuGn\")+ylab('')\nSurEmbarked=ggplot(train,aes(x=Embarked, fill=Survived))+geom_bar()+ scale_fill_brewer(palette = \"BuGn\")+ylab('')\ngrid.arrange(SurPc,Surage,SurFam,SurFare,SurSex,SurEmbarked, ncol=3) \n\n#From the diagram, we have a guess: people who are women, young but not too young, \n#have 1-2 companies have more chance to survive.\n", "metadata": {"_uuid": "5443abfe2fdaee95bee1d70e3025c7d6b5519780", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "##2. Calculate Single Factor Importance in Female Surviving\n\n### -Pclass: Not Be 3rd\n\ntable(train$Sex,train$Pclass,train$Survived)\n\n#The female survived in the Titanic most from first and second class, \n#the number of female in the first and second class died in Titanic is less than 10. \n#This is a very important factor.\n", "metadata": {"_uuid": "fd176ef3b688b78437ba984e5b7a8dfbd6d08feb", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "### -Parch: Good If You're Alone\n\ntable(train$Sex,train$Parch,train$Survived)\n\n#Women without any children or parents are more likely to survive \n#While the more parch they have, the less probability they can survive. \n", "metadata": {"_uuid": "f56af6b571202df64174c4d821dac81554898767", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "### -SibSp\n\ntable(train$Sex,train$SibSp,train$Survived)\n\n#Women without any siblings or spouses are more likely to survive.\n#While the more siblings they have, the less probability they can survive. \n", "metadata": {"_uuid": "86b04d28bd31d83af84c814ddd3074eb3d9b4195", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "### -Title\n\ntable(train$Sex,train$Title,train$Survived)\n\n#The survived unmarried women is more than married women, \n#which is accordance with the result about SibSp. Generally, \n#the number of women survived is more than the women died.", "metadata": {"_uuid": "cef9aba44a973b88fe4aa60058b10a75e7e76fcc", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "### -Data visualization\n\n####**Fare and Sex Whisker Plot**\n\nggplot(train)+geom_boxplot(aes(x=Sex,y=Fare,fill=Survived))\n\n#The lower whisker and lower quartile for all the four box are the same.\n#the survived female have higher median and upper quartier than the died female.\n#That shows female with higher fare or higher pclass have more chance for surviving.\n#it's the same with male's surviving, but the amount of surviving men is smaller than women.\n#The distribution of survived female is very sparse while the distribution of died male is very intensive.", "metadata": {"_uuid": "134dd1d8f3a892e668d73d73a6e95e5fd4616f29", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "####**Fare and Pclass Whisker Plot**\n\nggplot(train)+geom_boxplot(aes(x=Pclass,y=Fare,fill=Survived))\n\n#The charts shows that the fare in the first class has larger range than the second and third class.\n#The median of survived people in first class is equal to the upper quartier of dead people.\n#Generally, people in the first class with higher fare have more chance to survive.\n#The upper whisker of second and third class are almost equal to the lower quartier of first class.\n#The fare distribution of second and third class are more intensive than the first class.", "metadata": {"_uuid": "1ea71689cef6311866a26e52f36a758535a5dea7", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "####**Age and Pclass Violin Plot**\n\np<-ggplot(train,aes(factor(Pclass),Age))\np+geom_violin(aes(fill=Survived))\n\n#In the first class, most of survived people are around 35 years old and its range is very wide. \n#The distribution of the first class is even, no obvious concentrated trend.\n#In the second class, there is obvious concentrated trend at around 30 year old. \n#That shows most people are aronud 30 years old. The distribution of dead people's age is a little higher than survived people.\n#The concentrated trend at 20 year old in the third class is also very obvious. \n#The survived people in third class are younger than the dead people.", "metadata": {"_uuid": "263892fbb7e5a099fd978b0d07502018988ca8ed", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "####**Age and Sex Violin Plot**\n\np<-ggplot(train,aes(factor(Sex),Age))\np+geom_violin(aes(fill=Survived))\n\n#The distribution of male is wider than female generally. \n#Most survived women are around 20 to 30 years old.\n#The distribution of other women at other age is tend to be uniform.\n#The survived men's age is concentrated in 30 years old. \n#The distribution of other age is not uniform but extremely few.", "metadata": {"_uuid": "b71e56e8e0e26db2ae4c5bdc2e6b59e07448f564", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "####**Pclass,Age and Fare Scatter plot**\n\ntrain$Pclass=as.character(train$Pclass) #To make sure change safety\ntrain$Pclass=as.factor(train$Pclass)\np<-ggplot(data=train,mapping = aes(x=Age,y=Fare,shape=Pclass,color=Survived))\np+geom_point()\n\n#This scatter plot shows there is no linear relation between age and fare. \n#From the color scatter we can see, blue points are mostly on the top \n#wihle the red points are maily on the bottom. \n#That means the higher fare is, the more chances for surviving. \n#It also can be shown in the shape of different classes. \n#The first and second class get more chances for surviving compared to the third class.", "metadata": {"_uuid": "c0d7d2276992af22507c9ee219ece60367b4a7fb", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "####**Sex,Age and Fare Scatter plot**\n\np<-ggplot(data=train,mapping = aes(x=Age,y=Fare,shape=Sex,color=Survived))\np+geom_point()\n\n#The blue round points is more than blue squre points. \n#That shows females have more chances of surviving compared to males. \n#In addition, the higher fare of females bought, the higher chances for surviving.\n", "metadata": {"_uuid": "8e4025e4a3821a087a1e565991da4b24eb3e4164", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "##3.Analytics of Factors\n\n#Let's do some investigation at the influence of age, pclass, and sex to the survival. \n#in order to show the result vividly, we use ggplot2 to draw the facet_grid diagram.\n\nresult1 = ggplot(data = train, aes(x = Age, y = Sex, color = factor(Survived)))+geom_point()\nresult = result1+facet_grid(.~Pclass)+ggtitle(\"Social Status\")\nresult\n\n#In this diagram, we can see that age, pclas and sex are all important factors. \n#For those who were in the first class and who were female, \n#there was a bigger chance to survive. We can imagine the scene back then: \n#Titanic was falling, few lifeboats were prepared and young, well-classed ladies and madams \n#were rescued first.For those who landed lifeboats and left, the chance of survival was the biggest.\n#But for those females who were in the third class and the males, things were not so happy. \n#Lifeboats were limited, they must find their own way to make lives. \n#The possiblities of their living can be very small.", "metadata": {"_uuid": "c9faddd4240aee4ef3681bb61c78719d3e3fb602", "collapsed": false, "_execution_state": "idle"}, "cell_type": "code"}, {"execution_count": null, "outputs": [], "source": "#Also, we can discuss the relationship between survival and family size. \n#There are no factors called \"family size\", but we can conclude from siblings and parch. According to our experience, those who were with babies and  old people might have a bigger chance to survive. We can know if we are right from the following diagram.\n\nfamily = train$SibSp+train$Parch\nresult2 = ggplot(data = train, aes(x = Age, y = family, color = factor(Survived)))+geom_point()\nresult = result2+facet_grid(.~Sex)+ggtitle(\"Gender\")\nresult\n\n#Then we can see that our assumption is true. \n#First,females with 1 or 5,6 members in a family got the biggest chance of survival, \n#while those who had only 1 or 2 family members did not. \n#We can imagine that they might honorly give the chance of living to those who need most, \n#and choose to die with their husbands or fathers. \n#Males does not have a significant feature from the diagram. ", "cell_type": "code", "metadata": {"_uuid": "43dc476ad18a24761bb598fab342b78602f46bb8", "_cell_guid": "4614acd0-0a3c-4cd2-bbf4-bf761c38efbf", "_execution_state": "idle"}}], "nbformat": 4, "metadata": {"kernelspec": {"name": "ir", "language": "R", "display_name": "R"}, "language_info": {"name": "R", "mimetype": "text/x-r-source", "version": "3.4.0", "file_extension": ".r", "codemirror_mode": "r", "pygments_lexer": "r"}}}